<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="./jquery.min.js"></script>
    <style>
        html,body{
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        *{
            padding: 0;
            margin: 0;
            background: transparent;
        }
        #app{
            width: 100%;
            height: 100%;
            background-image: url('back.png');
            background-size: 100% 100%;
        }
        header{
            width: 100%;
            height: 18%;
            text-align: center;
            background: url('word.png') center bottom no-repeat;
            background-size: 70% auto;
        }
        #heart{
            width: 100%;
            height: 50%;
            text-align: center;
            background: url('xing.png') center center no-repeat;
            background-size: 70% auto;
            position: fixed;
            top:20%;
            left: 0;
            z-index: 6;
        }

        .xing{
            animation:change 1s infinite;
        }
        @keyframes change
        {
            0%   {background-image:url('xing.png');background-size: 70% auto;opacity: 1;}
            1%   {background-image:url('xing2.png');background-size: 69% auto;opacity: 1;}
            40%  {background-image:url('xing2.png');background-size: 50% auto;opacity:1;}
            41%  {background-image:url('xing2.png');background-size: 51% auto;opacity: 1;}
            50%  {background-image:url('xing2.png');background-size: 60% auto;opacity: 1;}
            51%  {background-image:url('xing.png');background-size: 59% auto;opacity:1;}
            60%  {background-image:url('xing.png');background-size: 50% auto;}
            80%  {background-image:url('xing.png');background-size: 70% auto;}
            100% {background-image:url('xing.png');background-size: 70% auto;}
        }
        #content{
            width: 100%;
            text-align: center;
            font-size: 2.1rem;
            font-weight: bold;
            color: #fd4b4b;
            position: fixed;
            bottom:22%;
            left: 0;
            z-index: 7;
        }
        .word{
            background-image: -webkit-gradient(linear,0 bottom,0 top, from(#fa0404), to(#ffcbcb));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        #num{
            color: #fa0404;
        }
        footer{
            position: fixed;
            bottom: 6%;
            left: 0;
            right: 0;
            z-index:6;
            text-align: center;
        }
        #btn{
            width: 56%;
        }
        .btnImg{
            animation:move 1s infinite;
        }
        @keyframes move
        {
            0%   {width:56%}
            20%  {width:56%}

            40%  {width:42%}
            50%  {width:50%}

            60%  {width:42%}
            80%  {width:56%}
            100% {width:56%}
        }
        #xing{
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 5;
            background: rgb(255, 255, 255,0.2);
        }
        #changeHeart{
            width: 1rem;
            height:1rem;
            position: fixed;
            top: 40%;
            left:45%;
            z-index: 5;
        }
        .smallXing{
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            margin: auto;
            width: 1rem;
            z-index: 5;
            transform: scale(1);
            opacity: 1;
        }
        #message{
            width: 100%;
            height: 3rem;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            margin: auto;
            z-index: 8;
            background:transparent;
            display: none;
            text-align: center;
            font-size: 2rem;
            color: #fa0404;
            font-weight: bold;
        }
    </style>
    
</head>
<body>
    <div id='app'>
        <header>
        </header>
        <div id='heart'>
        </div>
        <div id='content'>
            <span class="word">点亮爱心数:</span><span id='num'>0</span>
        </div>
        <footer>
            <img id='btn' src='btn.png'/>
        </footer>
        <div id='changeHeart'>

        </div>
        <div id='message'>

        </div>
    </div>
</body>
<script>

    $(function(){

        // let userId = location.search.split('=')[1];
        // let IP = location.origin;
        // let startTime = "";
        // let endTime = "";

        let userId = '1234';
        let startTime = new Date().getTime();
        let endTime = new Date().getTime()+30000;

        // startTime = startTime.replace(/-/g, '/');
        // endTime = endTime.replace(/-/g, '/');
        



        for(var i = 0;i<300;i++){
            let time = `img${i}`
            $('#changeHeart').append(`<img class="smallXing .change1 ${time}" src='xing2.png'/>`)
        }

        var k = 0,xingOut,m=150,xingOut2;
        function changeXing(){
            xingOut = setInterval(function(){
                if(new Date(startTime)<=new Date()&&new Date()<=new Date(endTime)){
                    k++
                    let left = (0.5 - Math.random())*2000+'px'
                    let bottom = (0.5 - Math.random())*2000+'px'
                    let scale = Math.random()*400+'%'
                    let opacity = Math.random()
                    $(`.img${k}`).animate({left:left,bottom:bottom,zIndex:7,width:scale,opacity:opacity},3000).fadeOut(1500);
                }
            },100)
        }
        // function changeXing2(){
        //     xingOut2 = setInterval(function(){
        //         if(new Date(startTime)<=new Date()&&new Date()<=new Date(endTime)){
        //             m++
        //             let left = (0.5 - Math.random())*2000+'px'
        //             let bottom = (0.5 - Math.random())*2000+'px'
        //             let scale = Math.random()*400+'%'
        //             let opacity = Math.random()
        //             $(`.img${m}`).animate({left:left,bottom:bottom,zIndex:7,width:scale,opacity:opacity},3000).fadeOut(1500);
        //         }
        //     },200)
        // }


        //爱心基金开始时间与结束时间
        // $.ajax({url:`${IP}/app/lover/heart/service.do?text={"msgId":"LOVE_HEART"}`,success:function(result){
        //     if(result.code == 0){
        //         startTime = result.resultMap.startTime.replace(/-/g, '/');
        //         endTime = result.resultMap.endTime.replace(/-/g, '/');
        //     }
        // }});


        $('#btn').click(function(){

            if((new Date().getTime()-new Date(startTime).getTime()>=0)&&(new Date(endTime).getTime()-new Date().getTime())>=0){//在活动时间可以点击爱心
                if(k===0){
                    changeXing()
                    // changeXing2()
                }
                $('#num').html($('#num').text()*1+1)
                setTimeout(function(){
                    $('#heart').addClass("xing");
                    $('#btn').addClass("btnImg");
                },0)

                let time = new Date(endTime) - new Date();
                setTimeout(function(){
                    $('#heart').removeClass("xing");//活动结束移除动画
                    $('#btn').removeClass("btnImg");//活动结束移除动画
                    $("#btn").unbind("click");//活动结束移除事件
                    $('#content').animate({fontSize: '2.7rem',bottom:'54%',zIndex:7},1000);//活动结束爱心点击数移到心中心
                    clearInterval(xingOut)
                    // clearInterval(xingOut2)
                },time)
            }
            if(new Date(startTime)>new Date()){
                $("#message").html('活动即将开始').fadeIn(800).fadeOut(800);
            }
            if(new Date(endTime)<new Date()){
                $("#message").html('活动已结束').fadeIn(800).fadeOut(800);
            }
            
            
        })
        var timeOut = setInterval(function(){
            if(new Date(endTime)<new Date()){
                let count = $('#num').text()
                //爱心基金结束请求
                // $.ajax({url:`${IP}/app/lover/heart/service.do?text={"msgId":"USER_CLICK_DATA","userId":"${userId}","count":"${count}"}`,success:function(result){
                //     if(result.code == 0){
                //         clearInterval(timeOut)
                //     }
                // }}); 
            }
        },1000)
          
    })


</script>
</html>