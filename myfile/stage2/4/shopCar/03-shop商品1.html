<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        *{padding: 0;margin: 0;list-style: none;}
        #box{width:300px;height:380px;margin:80px 0 0 80px;border:1px solid black;
            position:relative;}
        #big{position:absolute;left:320px;top:0;width:300px;height:300px;
            overflow:hidden;display:none;}
        #big img{width:900px;height:900px;position:absolute;top:0;left:0;}
        #main{width:300px;height:300px;position:relative; }
        #main img{width:300px;height:300px;}
        #show{width:100px;height:100px;background:rgba(120,120,120,.5);position:absolute;
            left:0;top:0;display:none;}
        #small .image{width:300px;height:80px;margin-top:20px;display:flex;justify-content:space-between;}
        #small .image li{float:left;}
        #small .image img{width:60px;height:60px;}
    </style>
</head>
<body>
<div id="box">
    <div id="big">
        <img id="bigimg" src="">
    </div>

    <div id="main">
        <img id="mainimg" src="">
        <div id="show"></div>
    </div>

    <div id="small">
        <ul class="image">
            <!--<li><img src="images/p1.jpg" ></li>-->
            <!--<li><img src="images/p2.jpg" ></li>-->
            <!--<li><img src="images/p3.jpg" ></li>-->
            <!--<li><img src="images/p4.jpg" ></li>-->
        </ul>
    </div>
    <div id="shopcar">
        <input id="goodsid" placeholder="商品编号"><br/>
        <input id="goodsname" placeholder="商品名称"><br/>
        <input id="goodsprice" placeholder="商品价格"><br/>
        <input id="goodsnum" placeholder="商品数量"><br/>
        <input id="goodsimg" placeholder="商品图片"><br/>
        <button id="btnshopcar">加入购物车</button>
    </div>
</div>
</body>
<!--<script src="00-$getNode.js"></script>-->
<!--<script src="00-Cookie.js"></script>-->
<script>
    var bigimg=$("#bigimg");
    var mainimg=$("#mainimg");
    var show=$("#show");
    var smallul=$("#small .image")[0];
    var box=$("#box");
    var big=$("#big");
    var main=$("#main");
    var smalllist=$("#min .image li");//获取li的集合
    var goodsimginput = document.getElementById("goodsimg");

    var goodslist=[{id:"A001",name:"商品1",price:100,smallimg:"images/A001-1.jpg"},
        {id:"A002",name:"商品2",price:200,smallimg:"images/A002-1.jpg"},
        {id:"A003",name:"商品3",price:300,smallimg:"images/A003-1.jpg"},
        {id:"A004",name:"商品4",price:400,smallimg:"images/A004-1.jpg"},
        {id:"A005",name:"商品5",price:500,smallimg:"images/A005-1.jpg"},
        {id:"A006",name:"商品6",price:600,smallimg:"images/A006-1.jpg"} ];
    var search=window.location.search.substring(1);
    if (search.indexOf("id")!=-1){
        var id=search.split("=")[1];
        var item=goodslist.filter(function (item){return item.id==id;});
        var goodsidA=item[0].id;
        var goodsimgA=item[0].smallimg;
        var goodsnameA=item[0].name;
        var goodspriceA=item[0].price;

        var text="";
        mainimg.src=goodsimgA;
        bigimg.src=goodsimgA;

        for (var i=1;i<=4;i++){
            text+=`<li><img src="images/${goodsidA+-i}.jpg" ></li>`
        }
        smallul.innerHTML=text;

    } else {window.location.href="03-shop.html"}



    for (var i=0;i<smalllist.length;i++) {
        var smallimg=smalllist[i];
        smallimg.onmouseover=function(){
            var img=this.getElementsByTagName("img")[0];
            bigimg.src=img.src;
            mainimg.src=img.src;
            goodsimginput.value=img.src;
        }
    }
    main.onmousemove=function (e) {
        big.style.display="block";
        show.style.display="block";
        var evt=window.event||e;
        var pageX=evt.clientX+document.documentElement.scrollLeft||document.body.scrollLeft;
        var pageY=evt.clientY+document.documentElement.scrollTop||document.body.scrollTop;

        var mainwidth=parseInt(getStyleAttr(main,"width"));//main宽度400
        var mainheight=parseInt(getStyleAttr(main,"height"));//main高度300

        var boxleft=parseInt(getStyleAttr(box,"margin-left"));//box左边距80
        var boxtop=parseInt(getStyleAttr(box,"margin-top"));//box上边距80

        var showwidth=parseInt(getStyleAttr(show,"width"));
        var showheight=parseInt(getStyleAttr(show,"height"));

        var bigwidth=parseInt(getStyleAttr(big,"width"));
        var bigheight=parseInt(getStyleAttr(big,"height"));

        var x=pageX-boxleft-showwidth/2;
        var y=pageY-boxtop-showheight/2;
        if (x<=0){x=0}
        if (x>=mainwidth-showwidth){x=mainwidth-showwidth}
        if (y<=0){y=0}
        if (y>=mainheight-showheight){y=mainheight-showheight;}
        show.style.left=x+"px";
        show.style.top=y+"px";
        bigimg.style.left=-(bigwidth/showwidth)*x+"px";
        bigimg.style.top=-(bigheight/showheight)*y+"px";
    };
    main.onmouseout=function () {
        big.style.display="none";
        show.style.display="none";
    };


    var goodsidinput = document.getElementById("goodsid");
    var goodsnameinput = document.getElementById("goodsname");
    var goodspriceinput = document.getElementById("goodsprice");
    var goodsnuminput = document.getElementById("goodsnum");
    // var goodsimginput = document.getElementById("goodsimg");
    var btnshopcar = document.getElementById("btnshopcar");

    goodsidinput.value=goodsidA;
    goodsnameinput.value=goodsnameA;
    goodspriceinput.value=goodspriceA;
    goodsnuminput.value=1;
    // goodsimginput.value=goodsimgA;

    btnshopcar.onclick = function () {
        var goodsid = goodsidinput.value;
        var goodsname = goodsnameinput.value;
        var goodsprice = goodspriceinput.value;
        var goodsnum = goodsnuminput.value;
        var goodsimg = goodsimginput.value;

        if (getCookie("goodsid_" + goodsid)) {
            var num = getCookie("goodsnum_" + goodsid);
            goodsnum = Number(num) + goodsnum * 1;
            setCookie("goodsnum_" + goodsid,goodsnum, 7);
            window.location.href="03-shop购物车.html";
        } else {
            setCookie("goodsid_" + goodsid, goodsid, 7);
            setCookie("goodsname_" + goodsid, goodsname, 7);
            setCookie("goodsprice_" + goodsid, goodsprice, 7);
            setCookie("goodsnum_" + goodsid, goodsnum, 7);
            setCookie("goodsimg_" + goodsid, goodsimg, 7);
            window.location.href="03-shop购物车.html";
        }
    };

    function getStyleAttr(obj,attr) {
        if (window.getComputedStyle){return getComputedStyle(obj)[attr]}
        else {return obj.currentStyle[attr]}
    }


    function $(ele, parent) {   //ele=(#first  .middle  span)
        parent = parent || document;
        if (ele.indexOf(" ") != -1) { //有空格就表示有多个层级
            var list = ele.split(" ");//把所有的层都找出来 ?[".ul", ".middle", "span"]
            for (var i = 0; i < list.length; i++) {
                var item = list[i];//   // #first  .middle  span
                if (i == list.length - 1) {//处理最后一层
                    return $(item, parent);
                } else {
                    if (item.indexOf("#") == 0) {//爹是唯一的
                        parent = $(item, parent);//返回#first
                    } else {
                        parent = $(item, parent)[0];//返回第一个.Middle
                    }
                }
            }
        } else {
            //一层.#first /.Middle  /div
            var firstCode = ele.charAt(0);//找到第一个字符
            if (firstCode == "#") {
                return parent.getElementById(ele.substring(1));
            } else if (firstCode == ".") {
                return parent.getElementsByClassName(ele.substring(1));
            } else {
                return parent.getElementsByTagName(ele);
            }
        }
    }
    function getCookie(key) {
        var cookies = document.cookie;
        if (cookies) {
            var cookieList = cookies.split("; ");//取出所有的cookie
            var value = "";
            cookieList.forEach(function (cookie) {
                var item = cookie.split("=");
                var itemKey = item[0];
                var itemValue = item[1];
                if (itemKey == key) {
                    value = itemValue;
                    return false;//终止里面函数的执行
                }
            });
            return value;
        } else {
            return "";
        }
    }
    function setCookie(key, value, days) {
        var date = new Date();
        date.setDate(date.getDate() + days);
        document.cookie = key + "=" + value + ";expires=" + date;
    }
</script>
</html>