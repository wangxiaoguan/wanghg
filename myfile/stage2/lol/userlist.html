<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>数据</title>
    <style>
        .search{text-align: center;margin:10px 0;}
        table{text-align: center;border-collapse: collapse;background:#06081B;color: #fff;}
        table th{width:70px;text-align:center;}
        .page{width:100px;height: 20px;margin:5px auto;color:red;}
    </style>
</head>
<body>
<div class="search">
    <input id="text" placeholder="搜索"><button id="search">查找</button>
    <input type="radio" value="id" name="radio" checked>编号
    <input type="radio" value="username" name="radio">用户名
    <button id="ascend">升序</button>
    <button id="descend">降序</button><br/><br/>
    <button id="prev">上一页</button>
    <select id="selectnum">
        <option value="10">每页显示10行数据</option>
        <option value="15">每页显示15行数据</option>
        <option value="20">每页显示20行数据</option>
    </select>
    <button id="next">下一页</button>
</div>
<table border="1" align="center">
    <thead>
    <tr>
        <th>编号</th>
        <th>用户名</th>
        <th>密码</th>
        <th>年龄</th>
        <th>性别</th>
        <th>电话</th>
        <th>操作</th>
    </tr>
    </thead>
    <tbody id="content">

    </tbody>
    <tfoot><tr><td colspan="7"><a href="useradd.html">添加数据</a></td></tr></tfoot>
</table>
<div class="page">◆第<span id="page" style="color:purple"></span>页◆</div>
</body>
<script src="js/config.js"></script>
<script src="js/cookie.js"></script>
<script src="js/ajax.js"></script>
<script src="js/userinfo.js"></script>
<script>
    var page=document.getElementById("page");//显示第几页
    var content=document.getElementById("content");
    var textinput=document.getElementById("text");
    var search=document.getElementById("search");
    var radiolist=document.getElementsByName("radio");
    var ascend=document.getElementById("ascend");
    var descend=document.getElementById("descend");
    var prev=document.getElementById("prev");
    var next=document.getElementById("next");
    var selectnum=document.getElementById("selectnum");


    //公共样式
    var key="";
    var order="id";
    var desc="asc";
    var pagenum=0;
    var datanum=10;

  page.innerHTML=pagenum+1;

getData(key,order,desc,pagenum,datanum);


selectnum.onchange= function () {
        datanum=this.value;
        pagenum=0;
        page.innerHTML=pagenum+1;
        getData(key,order,desc,pagenum,datanum);
}

search.onclick= function () {
        var word=textinput.value;
        key=word;
        pagenum=0;
        page.innerHTML=pagenum+1;
        getData(key,order,desc,pagenum,datanum);
    };

for(var i=0;i<radiolist.length;i++){
    radiolist[i].onclick= function () {
        order=this.value;
        pagenum=0;
        page.innerHTML=pagenum+1;
        getData(key,order,desc,pagenum,datanum);
    }
}
ascend.onclick= function () {
        desc="asc";
        pagenum=0;
        page.innerHTML=pagenum+1;
        getData(key,order,desc,pagenum,datanum);
    };
descend.onclick= function () {
        desc="desc";
        pagenum=0;
        page.innerHTML=pagenum+1;
        getData(key,order,desc,pagenum,datanum);
    };
function deleteone(key,obj){
    // if(confirm("确定删除吗?")){
        userinfo.deleteuser(urlphp.deleteuser,{id:key})
        .then(function(result){
            if(result.code==1){
                alert(result.msg);
            }else{
                alert(result.msg);
            }
        });
        // $.ajax({
        //     type:"get",
        //     url:"php/userdelete.php",
        //     data:{id:key},
        //     dataType:"json",
        //     fn:function(result){
        //             if(result.code==1){
        //                 alert(result.msg);
        //             }else{
        //                 alert(result.msg);
        //             }
        //     }
        // });
            var tr=obj.parentNode.parentNode;
            content.removeChild(tr);
    // }
}
    function getData(key,order,desc,pagenum,datanum){
        userinfo.userlist(urlphp.userlist,{key:key,order:order,desc:desc,pagenum:pagenum,datanum:datanum})
        .then(function(list){
            var html="";
                for(var i=0;i<list.length;i++){
                    var item=list[i];
                    var id=item["id"];
                    var username=item["username"];
                    var userpwd=item["userpwd"];
                    var userage=item["userage"];
                    var usersex=item["usersex"];
                    var usertell=item["usertell"];
                    if(usersex==0){usersex="女";}else{usersex="男";}
                    html+=`<tr id="${id}">
                    <td>${id}</td>
                    <td>${username}</td>
                    <td>${userpwd}</td>
                    <td>${userage}</td>
                    <td>${usersex}</td>
                    <td>${usertell}</td>
                    <td><a href="userupdate.html?id=${id}">编辑</a><span onclick="deleteone(${id},this)">删除</span></td></tr>`;
                }
                content.innerHTML=html;
                userinfo.usersearch(urlphp.usersearch,{key:key})
                .then(function(obj){
                    var count=obj["count"];
                        var pagemax=Math.ceil(count/datanum-1);
                        prev.disabled=false;
                        prev.onclick= function () {
                            pagenum--;
                            page.innerHTML=pagenum+1;
                            getData(key,order,desc,pagenum,datanum);                    
                        };
                        next.disabled=false;
                        next.onclick= function () {
                            pagenum++;
                            page.innerHTML=pagenum+1;
                            getData(key,order,desc,pagenum,datanum);                           
                        };
                        if(pagenum==0){
                            prev.disabled=true;
                            prev.onclick=null;
                        };
                        if(pagenum==pagemax){
                            next.disabled=true;
                            next.onclick=null;
                        }
                })
        })
}
 
</script>
</html>