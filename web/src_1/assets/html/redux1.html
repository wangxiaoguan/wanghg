<!DOCTYPE html>
<html lang="en" style='height:100%'>
  <head>
    <meta charset="utf-8">
    <title>从零搭建React全家桶框架教程 · Issue #1 · brickspert/blog · GitHub</title>
    <style>
        html,body{
            padding:0;
            margin:0;
        }
        .app {
            font-size: 16px;
            padding:0 15px;
            width:calc(100% - 30px);
            height:100%;
            overflow:hidden auto;
            background: #f5f8dc;
        }
        
        .bottom {
            margin-bottom: 16px;
        }

        pre{
            border-radius: 3px;
            font-size: 85%;
            line-height: 1.45;
            overflow: auto;
            padding: 16px;
            background: #f0f0f0;
            font-family:'Consolas';
        }
        .pl-c {color: #6a737d;}
        .pl-k {color: #d73a49;}
        .pl-en {color: #6f42c1;}
        .pl-c1{color: #005cc5;}
        .pl-smi {color: #24292e;}
    </style>
  </head>
<body style='height:100%'>
    <div class="app">
    <h1>从零搭建React全家桶框架教程</h1>
<p>源码地址：<a href="https://github.com/brickspert/react-family">https://github.com/brickspert/react-family</a><br>
提问反馈：<a href="https://github.com/brickspert/blog/issues/1" data-hovercard-type="issue" data-hovercard-url="/brickspert/blog/issues/1/hovercard">blog</a></p>
<h2>因为本教程写于2017年9月，然而前端技术发展太快了。有些库的版本一直在升级，所以你如果碰到奇怪的问题，请先检查下安装的库版本是否和我源码中的一样。please~</h2>
<h2>大家阅读的时候，照着目录来阅读哦，有些章节不在文章里面。要点链接的~</h2>
<h1>目录</h1>
<ol>
<li><a href="#intro">写在前面</a></li>
<li><a href="#explain">说明</a></li>
<li><a href="#init">init项目</a></li>
<li><a href="#webpack">webpack</a></li>
<li><a href="#babel">babel</a></li>
<li><a href="#react">react</a></li>
<li><a href="#command">命令优化</a></li>
<li><a href="#react-router">react-router</a></li>
<li><a href="#webpack-dev-server">webpack-dev-server</a></li>
<li><a href="#hot-module-replacement">模块热替换（Hot Module Replacement）</a></li>
<li><a href="#path">文件路径优化</a></li>
<li><a href="#redux">redux</a></li>
<li><a href="#devtool">devtool优化</a></li>
<li><a href="#css">编译css</a></li>
<li><a href="#image">编译图片</a></li>
<li><a href="#code-split">按需加载</a></li>
<li><a href="#cache">缓存</a></li>
<li><a href="#HtmlWebpackPlugin">HtmlWebpackPlugin</a></li>
<li><a href="#common-code">提取公共代码</a></li>
<li><a href="#product">生产坏境构建</a></li>
<li><a href="#uglify">文件压缩</a></li>
<li><a href="#env">指定环境</a></li>
<li><a href="#op-cache">优化缓存</a></li>
<li><a href="#publicPath">public path</a></li>
<li><a href="#op-build">打包优化</a></li>
<li><a href="#extract-text">抽取css</a></li>
<li><a href="#op-http">使用<code>axios</code>和<code>middleware</code>优化API请求</a></li>
<li><a href="#webpack-common-config">合并提取<code>webpack</code>公共配置 webpack-common-config</a>(2017-09-04)</li>
<li><a href="#op-dir-404">优化目录结构并增加404页面</a>(2017-09-04)</li>
<li><a href="#babel-polyfill">加入 babel-plugin-transform-runtime 和 babel-polyfill</a>(2017-09-17)</li>
<li><a href="#postcss">集成PostCSS</a>(2017-09-17)</li>
<li><a href="#redux-hot">redux 模块热替换配置</a>(2017-09-26)</li>
<li><a href="#mockjs">模拟AJAX数据之Mock.js</a>(2017-11-21)</li>
<li><a href="#css-modules">使用 CSS Modules</a>(2017-12-13)</li>
<li><a href="#json-server">使用 json-server 代替 Mock.js</a>(2017-12-18)</li>
<li><a href="#question">问题修复</a></li>
</ol>
<h1><div id="intro">写在前面</div></h1>
<p>当我第一次跟着项目做<code>react</code>项目的时候，由于半截加入的，对框架了解甚少，只能跟着别人的样板写。对整个框架没有一点了解。</p>
<p>做项目，总是要解决各种问题的，所以每个地方都需要去了解，但是对整个框架没有一个整体的了解，实在是不行。</p>
<p>期间，我也跟着别人的搭建框架的教程一步一步的走，但是经常因为自己太菜，走不下去。在经过各种蹂躏之后，对整个框架也有一个大概的了解，<br>
我就想把他写下来，让后来的菜鸟能跟着我的教程对<code>react</code>全家桶有一个全面的认识。</p>
<p>我的这个教程，从新建根文件夹开始，到成型的框架，每个文件为什么要建立？建立了干什么？每个依赖都是干什么的？一步一步写下来，供大家学习。</p>
<p>当然，这个框架我以后会一直维护的，<strong>也希望大家能一起来完善这个框架</strong>，如果您有任何建议，欢迎在这里留言，欢迎<code>fork</code>源码<a href="https://github.com/brickspert/react-family">react-family</a>。</p>
<p>我基于该框架<code>react-family</code>又做了一个兼容IE8的版本，教程在这里<a href="https://github.com/brickspert/blog/issues/5" data-hovercard-type="issue" data-hovercard-url="/brickspert/blog/issues/5/hovercard">react-family框架兼容IE8教程</a>。</p>
<h1><div id="explain">说明</div></h1>
<ol>
<li>每个命令行块都是以<strong>根目录</strong>为基础的。例如下面命令行块，都是基于根目录的。</li>
</ol>
<div class="bottom"><pre>cd src<span class="pl-k">/</span>pages
mkdir Home</pre></div>
<ol>
<li>技术栈均是目前最新的。</li>
</ol>
<ul>
<li>react 15.6.1</li>
<li>react-router-dom 4.2.2</li>
<li>redux 3.7.2</li>
<li>webpack 3.5.5</li>
</ul>
<ol>
<li>目录说明</li>
</ol>
<div class="bottom"><pre>│  .<span class="pl-smi">babelrc</span>                          #babel配置文件
│  <span class="pl-k">package</span><span class="pl-k">-</span><span class="pl-smi">lock</span>.<span class="pl-smi">json</span>
│  <span class="pl-k">package</span>.<span class="pl-smi">json</span>
│  <span class="pl-c1">README</span>.<span class="pl-c1">MD</span>
│  <span class="pl-smi">webpack</span>.<span class="pl-smi">config</span>.<span class="pl-smi">js</span>                 #webpack生产配置文件
│  <span class="pl-smi">webpack</span>.<span class="pl-smi">dev</span>.<span class="pl-smi">config</span>.<span class="pl-smi">js</span>             #webpack开发配置文件
│  
├─dist
├─<span class="pl-k">public</span>                             #公共资源文件
└─src                                #项目源码
    │  <span class="pl-smi">index</span>.<span class="pl-smi">html</span>                    #<span class="pl-smi">index</span>.<span class="pl-smi">html</span>模板
    │  <span class="pl-smi">index</span>.<span class="pl-smi">js</span>                      #入口文件
    │  
    ├─component                      #组建库
    │  └─Hello
    │          <span class="pl-smi">Hello</span>.<span class="pl-smi">js</span>
    │          
    ├─pages                          #页面目录
    │  ├─Counter
    │  │      <span class="pl-smi">Counter</span>.<span class="pl-smi">js</span>
    │  │      
    │  ├─Home
    │  │      <span class="pl-smi">Home</span>.<span class="pl-smi">js</span>
    │  │      
    │  ├─Page1
    │  │  │  <span class="pl-smi">Page1</span>.<span class="pl-smi">css</span>                #页面样式
    │  │  │  <span class="pl-smi">Page1</span>.<span class="pl-smi">js</span>
    │  │  │  
    │  │  └─images                    #页面图片
    │  │          <span class="pl-smi">brickpsert</span>.<span class="pl-smi">jpg</span>
    │  │          
    │  └─UserInfo
    │          <span class="pl-smi">UserInfo</span>.<span class="pl-smi">js</span>
    │          
    ├─redux
    │  │  <span class="pl-smi">reducers</span>.<span class="pl-smi">js</span>
    │  │  <span class="pl-smi">store</span>.<span class="pl-smi">js</span>
    │  │  
    │  ├─actions
    │  │      <span class="pl-smi">counter</span>.<span class="pl-smi">js</span>
    │  │      <span class="pl-smi">userInfo</span>.<span class="pl-smi">js</span>
    │  │      
    │  ├─middleware
    │  │      <span class="pl-smi">promiseMiddleware</span>.<span class="pl-smi">js</span>
    │  │      
    │  └─reducers
    │          <span class="pl-smi">counter</span>.<span class="pl-smi">js</span>
    │          <span class="pl-smi">userInfo</span>.<span class="pl-smi">js</span>
    │          
    └─router                        #路由文件
            <span class="pl-smi">Bundle</span>.<span class="pl-smi">js</span>
            <span class="pl-smi">router</span>.<span class="pl-smi">js</span>
            
</pre></div>
<h1><div id="init">init项目</div></h1>
<ol>
<li>
<p>创建文件夹并进入</p>
<p><code>mkdir react-family &amp;&amp; cd react-family</code></p>
</li>
<li>
<p>init npm</p>
<p><code>npm init</code> 按照提示填写项目基本信息</p>
</li>
</ol>
<h1><div id="webpack">webpack</div></h1>
<ol>
<li>
<p>安装 <code>webpack</code></p>
<p><code>npm install --save-dev webpack@3</code></p>
<p>Q: 什么时候用<code>--save-dev</code>，什么时候用<code>--save</code>？</p>
<p>A:  <code>--save-dev</code> 是你开发时候依赖的东西，<code>--save</code> 是你发布之后还依赖的东西。看<a href="https://segmentfault.com/q/1010000005163089" rel="nofollow">这里</a></p>
</li>
<li>
<p>根据<a href="https://doc.webpack-china.org/guides/getting-started" rel="nofollow">webpack文档</a>编写最基础的配置文件</p>
<p>新建<code>webpack</code>开发配置文件 <code>touch webpack.dev.config.js</code></p>
<p><code>webpack.dev.config.js</code></p>
<div class="bottom"><pre><span class="pl-k">const</span> <span class="pl-c1">path</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>);

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> {
 
    <span class="pl-c"><span class="pl-c">/*</span>入口<span class="pl-c">*/</span></span>
    entry<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/index.js<span class="pl-pds">'</span></span>),
    
    <span class="pl-c"><span class="pl-c">/*</span>输出到dist文件夹，输出文件名字为bundle.js<span class="pl-c">*/</span></span>
    output<span class="pl-k">:</span> {
        path<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>./dist<span class="pl-pds">'</span></span>),
        filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>bundle.js<span class="pl-pds">'</span></span>
    }
};</pre></div>
</li>
<li>
<p>学会使用<code>webpack</code>编译文件</p>
<p>新建入口文件</p>
<p><code>mkdir src &amp;&amp; touch ./src/index.js</code></p>
<p><code>src/index.js</code> 添加内容</p>
<p><code>document.getElementById('app').innerHTML = "Webpack works"</code></p>
<p>现在我们执行命令 <code>webpack --config webpack.dev.config.js</code></p>
<blockquote>
<p>webpack如果没有全局安装，这里会报错哦。命令建议全局安装，如果编译有问题看这里 <a class="issue-link js-issue-link" data-error-text="Failed to load issue title" data-id="254803621" data-permission-text="Issue title is private" data-url="https://github.com/brickspert/blog/issues/1" data-hovercard-type="issue" data-hovercard-url="/brickspert/blog/issues/1/hovercard?comment_id=326899255&amp;comment_type=issue_comment" href="https://github.com/brickspert/blog/issues/1#issuecomment-326899255">#1 (comment)</a></p>
</blockquote>
<p>我们可以看到生成了<code>dist</code>文件夹和<code>bundle.js</code>。</p>
</li>
<li>
<p>现在我们测试下~</p>
<p><code>dist</code>文件夹下面新建一个<code>index.html</code></p>
<p><code>touch ./dist/index.html</code></p>
<p><code>dist/index.html</code>填写内容</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;!doctype html&gt;
&lt;<span class="pl-ent">html</span> <span class="pl-e">lang</span>=<span class="pl-s"><span class="pl-pds">"</span>en<span class="pl-pds">"</span></span>&gt;
&lt;<span class="pl-ent">head</span>&gt;
    &lt;<span class="pl-ent">meta</span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">title</span>&gt;Document&lt;/<span class="pl-ent">title</span>&gt;
&lt;/<span class="pl-ent">head</span>&gt;
&lt;<span class="pl-ent">body</span>&gt;
&lt;<span class="pl-ent">div</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>app<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">div</span>&gt;
&lt;<span class="pl-ent">script</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>text/javascript<span class="pl-pds">"</span></span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>./bundle.js<span class="pl-pds">"</span></span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;
&lt;/<span class="pl-ent">body</span>&gt;
&lt;/<span class="pl-ent">html</span>&gt;</pre></div>
<p>用浏览器打开<code>index.html</code>,可以看到<code>Webpack works</code>!</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/f011eda1205f66f52dea4c7d7d8ae6c0de1c8630/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f7765627061636b2e706e67"><img src="https://camo.githubusercontent.com/f011eda1205f66f52dea4c7d7d8ae6c0de1c8630/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f7765627061636b2e706e67" alt="webpack" data-canonical-src="http://oqcb8djlw.bkt.clouddn.com/webpack.png" style="max-width:100%;"></a></p>
<p>现在回头看下，我们做了什么或者说<code>webpack</code>做了什么。</p>
<p>把入口文件 <code>index.js</code> 经过处理之后，生成 <code>bundle.js</code>。就这么简单。</p>
</li>
</ol>
<h1><div id="babel">babel</div></h1>
<blockquote>
<p>Babel 把用最新标准编写的 JavaScript 代码向下编译成可以在今天随处可用的版本。 这一过程叫做“源码到源码”编译， 也被称为转换编译。</p>
</blockquote>
<p>通俗的说，就是我们可以用ES6, ES7等来编写代码，Babel会把他们统统转为ES5。</p>
<ul>
<li>
<p><a href="https://github.com/babel/babel/tree/master/packages/babel-core">babel-core</a> 调用Babel的API进行转码</p>
</li>
<li>
<p><a href="https://github.com/babel/babel-loader">babel-loader</a></p>
</li>
<li>
<p><a href="https://github.com/babel/babel/tree/master/packages/babel-preset-es2015">babel-preset-es2015</a> 用于解析 ES6</p>
</li>
<li>
<p><a href="https://github.com/babel/babel/tree/master/packages/babel-preset-react">babel-preset-react</a> 用于解析 JSX</p>
</li>
<li>
<p><a href="https://github.com/babel/babel/tree/master/packages/babel-preset-stage-0">babel-preset-stage-0</a> 用于解析 ES7 提案</p>
<p><code>npm install --save-dev babel-core  babel-loader babel-preset-es2015 babel-preset-react babel-preset-stage-0</code></p>
<p>新建<code>babel</code>配置文件<code>.babelrc</code></p>
<p><code>touch .babelrc</code></p>
<p><code>.babelrc</code></p>
</li>
</ul>
<div class="highlight highlight-source-json"><pre>    {
      <span class="pl-s"><span class="pl-pds">"</span>presets<span class="pl-pds">"</span></span>: [
        <span class="pl-s"><span class="pl-pds">"</span>es2015<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>react<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>stage-0<span class="pl-pds">"</span></span>
      ],
      <span class="pl-s"><span class="pl-pds">"</span>plugins<span class="pl-pds">"</span></span>: []
    }
</pre></div>
<p>修改<code>webpack.dev.config.js</code>，增加<code>babel-loader</code>！</p>
<div class="highlight highlight-source-json"><pre>    /*src文件夹下面的以.js结尾的文件，要使用babel解析*/
    /*cacheDirectory是用来缓存编译结果，下次编译加速*/
    module: {
        <span class="pl-ii">rules</span>: [{
            <span class="pl-ii">test</span>: <span class="pl-ii">/\.js$/</span>,
            <span class="pl-ii">use</span>: [<span class="pl-ii">'babel-loader?cacheDirectory=</span><span class="pl-c1">true</span><span class="pl-ii">'</span>],
            <span class="pl-ii">include</span>: <span class="pl-ii">path.join(__dirname</span>, <span class="pl-ii">'src')</span>
        }]
    }</pre></div>
<p>现在我们简单测试下，是否能正确转义ES6~<br>
​<br>
修改 <code>src/index.js</code></p>
<div class="bottom"><pre>    <span class="pl-c"><span class="pl-c">/*</span>使用es6的箭头函数<span class="pl-c">*/</span></span>
    <span class="pl-k">var</span> <span class="pl-en">func</span> <span class="pl-k">=</span> <span class="pl-smi">str</span> <span class="pl-k">=&gt;</span> {
        <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>app<span class="pl-pds">'</span></span>).<span class="pl-smi">innerHTML</span> <span class="pl-k">=</span> str;
    };
    <span class="pl-en">func</span>(<span class="pl-s"><span class="pl-pds">'</span>我现在在使用Babel!<span class="pl-pds">'</span></span>);</pre></div>
<p>执行打包命令<code>webpack --config webpack.dev.config.js</code></p>
<p>浏览器打开<code>index.html</code>，我们看到正确输出了<code>我现在在使用Babel!</code></p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/5690689fbf4b45f863e3f7d50b347acc3138446d/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f626162656c2e706e67"><img src="https://camo.githubusercontent.com/5690689fbf4b45f863e3f7d50b347acc3138446d/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f626162656c2e706e67" alt="babel" data-canonical-src="http://oqcb8djlw.bkt.clouddn.com/babel.png" style="max-width:100%;"></a></p>
<p>然后我们打开打包后的<code>bundle.js</code>,翻页到最下面,可以看到箭头函数被转换成普通函数了！</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/bb95602c7614071feeadbfab6deb89e1da4a3999/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f626162656c2d62756e646c652e706e67"><img src="https://camo.githubusercontent.com/bb95602c7614071feeadbfab6deb89e1da4a3999/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f626162656c2d62756e646c652e706e67" alt="babel-bundle.png" data-canonical-src="http://oqcb8djlw.bkt.clouddn.com/babel-bundle.png" style="max-width:100%;"></a></p>
<p>Q: <code>babel-preset-state-0</code>,<code>babel-preset-state-1</code>,<code>babel-preset-state-2</code>,<code>babel-preset-state-3</code>有什么区别？</p>
<p>A: 每一级包含上一级的功能，比如 <code>state-0</code>包含<code>state-1</code>的功能，以此类推。<code>state-0</code>功能最全。具体可以看这篇文章：<a href="https://www.vanadis.cn/2017/03/18/babel-stage-x/" rel="nofollow">babel配置-各阶段的stage的区别</a></p>
<p>参考地址：</p>
<ol>
<li>
<p><a href="https://segmentfault.com/a/1190000008159877" rel="nofollow">https://segmentfault.com/a/1190000008159877</a></p>
</li>
<li>
<p><a href="http://www.ruanyifeng.com/blog/2016/01/babel.html" rel="nofollow">http://www.ruanyifeng.com/blog/2016/01/babel.html</a></p>
</li>
</ol>
<h1><div id="react">react</div></h1>
<p><code>npm install --save react react-dom</code></p>
<p>修改 <code>src/index.js</code>使用<code>react</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">ReactDom</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-dom<span class="pl-pds">'</span></span>;

<span class="pl-smi">ReactDom</span>.<span class="pl-en">render</span>(
    <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>Hello React<span class="pl-k">!</span><span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>, <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>app<span class="pl-pds">'</span></span>));</pre></div>
<p>执行打包命令<code>webpack --config webpack.dev.config.js</code></p>
<p>打开<code>index.html</code> 看效果。</p>
<p>我们简单做下改进，把<code>Hello React</code>放到组件里面。体现组件化~</p>
<div class="bottom"><pre>cd src
mkdir component
cd component
mkdir Hello
cd Hello
touch <span class="pl-smi">Hello</span>.<span class="pl-smi">js</span></pre></div>
<p>按照React语法，写一个Hello组件</p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">class</span> <span class="pl-en">Hello</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {
    <span class="pl-en">render</span>() {
        <span class="pl-k">return</span> (
            <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
                Hello,React<span class="pl-k">!</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        )
    }
}</pre></div>
<p>然后让我们修改<code>src/index.js</code>，引用<code>Hello</code>组件！</p>
<p><code>src/index.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">ReactDom</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-dom<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">Hello</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./component/Hello/Hello<span class="pl-pds">'</span></span>;

<span class="pl-smi">ReactDom</span>.<span class="pl-en">render</span>(
    <span class="pl-k">&lt;</span>Hello<span class="pl-k">/</span><span class="pl-k">&gt;</span>, <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>app<span class="pl-pds">'</span></span>));</pre></div>
<p>在<strong>根目录</strong>执行打包命令</p>
<p><code>webpack --config webpack.dev.config.js</code></p>
<p>打开<code>index.html</code>看效果咯~</p>
<h1><div id="command">命令优化</div></h1>
<p>Q：每次打包都得在根目录执行这么一长串命令<code>webpack --config webpack.dev.config.js</code>,能不打这么长吗？</p>
<p>A：修改<code>package.json</code>里面的<code>script</code>，增加<code>dev-build</code>。</p>
<p><code>package.json</code></p>
<div class="highlight highlight-source-json"><pre>  <span class="pl-s"><span class="pl-pds">"</span>scripts<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>echo <span class="pl-cce">\"</span>Error: no test specified<span class="pl-cce">\"</span> &amp;&amp; exit 1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>dev-build<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>webpack --config webpack.dev.config.js<span class="pl-pds">"</span></span>
  }</pre></div>
<p>现在我们打包只需要执行<code>npm run dev-build</code>就可以啦！</p>
<p>参考地址：</p>
<p><a rel="nofollow" href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html">http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html</a></p>
<h1><div id="react-router">react-router</div></h1>
<p><code>npm install  --save react-router-dom</code></p>
<p>新建<code>router</code>文件夹和组件</p>
<pre><code>cd src
mkdir router &amp;&amp; touch router/router.js
</code></pre>
<p>按照<code>react-router</code><a href="http://reacttraining.cn/web/guides/quick-start" rel="nofollow">文档</a>编辑一个最基本的<code>router.js</code>。包含两个页面<code>home</code>和<code>page1</code>。</p>
<p><code>src/router/router.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> {<span class="pl-smi">BrowserRouter</span> <span class="pl-k">as</span> <span class="pl-smi">Router</span>, <span class="pl-smi">Route</span>, <span class="pl-smi">Switch</span>, <span class="pl-smi">Link</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-router-dom<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">Home</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../pages/Home/Home<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">Page1</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../pages/Page1/Page1<span class="pl-pds">'</span></span>;


<span class="pl-k">const</span> <span class="pl-c1">getRouter</span> <span class="pl-k">=</span> () <span class="pl-k">=&gt;</span> (
    <span class="pl-k">&lt;</span>Router<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>ul<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>首页<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/page1<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>Page1<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>ul<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>Switch<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route exact path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{Home}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/page1<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{Page1}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>Switch<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>Router<span class="pl-k">&gt;</span>
);

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">getRouter</span>;</pre></div>
<p>新建页面文件夹</p>
<pre><code>cd src
mkdir pages
</code></pre>
<p>新建两个页面 <code>Home</code>,<code>Page1</code></p>
<pre><code>cd src/pages
mkdir Home &amp;&amp; touch Home/Home.js
mkdir Page1 &amp;&amp; touch Page1/Page1.js
</code></pre>
<p>填充内容：</p>
<p><code>src/pages/Home/Home.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">class</span> <span class="pl-en">Home</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {
    <span class="pl-en">render</span>() {
        <span class="pl-k">return</span> (
            <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
                <span class="pl-c1">this</span> is home<span class="pl-k">~</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        )
    }
}</pre></div>
<p>Page1.js</p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">class</span> <span class="pl-en">Page1</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {
    <span class="pl-en">render</span>() {
        <span class="pl-k">return</span> (
            <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
                <span class="pl-c1">this</span> is Page1<span class="pl-k">~</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        )
    }
}</pre></div>
<p>现在路由和页面建好了，我们在入口文件<code>src/index.js</code>引用Router。</p>
<p>修改<code>src/index.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">ReactDom</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-dom<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">getRouter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./router/router<span class="pl-pds">'</span></span>;

<span class="pl-smi">ReactDom</span>.<span class="pl-en">render</span>(
    <span class="pl-en">getRouter</span>(), <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>app<span class="pl-pds">'</span></span>));</pre></div>
<p>现在执行打包命令<code>npm run dev-build</code>。打开<code>index.html</code>查看效果啦！</p>
<p>那么问题来了~我们发现点击‘首页’和‘Page1’没有反应。不要惊慌，这是正常的。</p>
<p>我们之前一直用这个路径访问<code>index.html</code>，类似这样：<code>file:///F:/react/react-family/dist/index.html</code>。<br>
这种路径了，不是我们想象中的路由那样的路径<code>http://localhost:3000</code>~我们需要配置一个简单的WEB服务器，指向<br>
<code>index.html</code>~有下面两种方法来实现</p>
<ol>
<li><code>Nginx</code>, <code>Apache</code>, <code>IIS</code>等配置启动一个简单的的WEB服务器。</li>
<li>使用<code>webpack-dev-server</code>来配置启动WEB服务器。</li>
</ol>
<p>下一节，我们来使用第二种方法启动服务器。这一节的DEMO，先放这里。</p>
<p>参考地址</p>
<ol>
<li><a href="http://www.jianshu.com/p/e3adc9b5f75c" rel="nofollow">http://www.jianshu.com/p/e3adc9b5f75c</a></li>
<li><a href="http://reacttraining.cn/web/guides/quick-start" rel="nofollow">http://reacttraining.cn/web/guides/quick-start</a></li>
</ol>
<h1><div id="webpack-dev-server">webpack-dev-server</div></h1>
<p>简单来说，<code>webpack-dev-server</code>就是一个小型的静态文件服务器。使用它，可以为<code>webpack</code>打包生成的资源文件提供Web服务。</p>
<p><code>npm install webpack-dev-server@2 --save-dev</code></p>
<blockquote>
<p>2017.11.16补充：这里webpack-dev-server需要全局安装，要不后面用的时候要写相对路径。需要再执行这个 <code>npm install webpack-dev-server@2 -g</code></p>
</blockquote>
<p>修改<code>webpack.dev.config.js</code>,增加<code>webpack-dev-server</code>的配置。</p>
<p><code>webpack.dev.config.js</code></p>
<div class="bottom"><pre>    devServer<span class="pl-k">:</span> {
        contentBase<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>./dist<span class="pl-pds">'</span></span>)
    }</pre></div>
<p>现在执行</p>
<p><code>webpack-dev-server --config webpack.dev.config.js</code></p>
<p>浏览器打开<a rel="nofollow" href="http://localhost:8080">http://localhost:8080</a>，OK,现在我们可以点击<code>首页</code>,<code>Page1</code>了，<br>
看URL地址变化啦！我们看到<code>react-router</code>已经成功了哦。</p>
<p>Q: <code>--content-base</code>是什么？</p>
<p>A：<code>URL的根目录。如果不设定的话，默认指向项目根目录。</code></p>
<p><strong>重要提示：webpack-dev-server编译后的文件，都存储在内存中，我们并不能看见的。你可以删除之前遗留的文件<code>dist/bundle.js</code>，<br>
仍然能正常打开网站！</strong></p>
<p>每次执行<code>webpack-dev-server --config webpack.dev.config.js</code>,要打很长的命令，我们修改<code>package.json</code>，增加<code>script-&gt;start</code>:</p>
<div class="bottom"><pre>  <span class="pl-s"><span class="pl-pds">"</span>scripts<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
    <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>echo <span class="pl-cce">\"</span>Error: no test specified<span class="pl-cce">\"</span> &amp;&amp; exit 1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>dev-build<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>webpack --config webpack.dev.config.js<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>start<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>webpack-dev-server --config webpack.dev.config.js<span class="pl-pds">"</span></span>
  }</pre></div>
<p>下次执行<code>npm start</code>就可以了。</p>
<p>既然用到了<code>webpack-dev-server</code>，我们就看看<a href="https://doc.webpack-china.org/configuration/dev-server" rel="nofollow">它的其他的配置项</a>。<br>
看了之后，发现有几个我们可以用的。</p>
<ul>
<li>color（CLI only） <code>console</code>中打印彩色日志</li>
<li>historyApiFallback 任意的<code>404</code>响应都被替代为<code>index.html</code>。有什么用呢？你现在运行<br>
<code>npm start</code>，然后打开浏览器，访问<code>http://localhost:8080</code>,然后点击<code>Page1</code>到链接<code>http://localhost:8080/page1</code>，<br>
然后刷新页面试试。是不是发现刷新后<code>404</code>了。为什么？<code>dist</code>文件夹里面并没有<code>page1.html</code>,当然会<code>404</code>了，所以我们需要配置<br>
<code>historyApiFallback</code>，让所有的<code>404</code>定位到<code>index.html</code>。</li>
<li>host 指定一个<code>host</code>,默认是<code>localhost</code>。如果你希望服务器外部可以访问，指定如下：<code>host: "0.0.0.0"</code>。比如你用手机通过IP访问。</li>
<li>hot 启用<code>Webpack</code>的模块热替换特性。关于热模块替换，我下一小节专门讲解一下。</li>
<li>port 配置要监听的端口。默认就是我们现在使用的<code>8080</code>端口。</li>
<li>proxy 代理。比如在 <code>localhost:3000</code> 上有后端服务的话，你可以这样启用代理：</li>
</ul>
<div class="bottom"><pre>    proxy<span class="pl-k">:</span> {
      <span class="pl-s"><span class="pl-pds">"</span>/api<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>http://localhost:3000<span class="pl-pds">"</span></span>
    }</pre></div>
<ul>
<li>progress（CLI only） 将编译进度输出到控制台。</li>
</ul>
<p>根据这几个配置，修改下我们的<code>webpack-dev-server</code>的配置~</p>
<p><code>webpack.dev.config.js</code></p>
<div class="bottom"><pre>    devServer<span class="pl-k">:</span> {
        port<span class="pl-k">:</span> <span class="pl-c1">8080</span>,
        contentBase<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>./dist<span class="pl-pds">'</span></span>),
        historyApiFallback<span class="pl-k">:</span> <span class="pl-c1">true</span>,
        host<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>0.0.0.0<span class="pl-pds">'</span></span>
    }</pre></div>
<p><code>CLI ONLY</code>的需要在命令行中配置</p>
<p><code>package.json</code></p>
<div class="bottom"><pre><span class="pl-s"><span class="pl-pds">"</span>start<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>webpack-dev-server --config webpack.dev.config.js --color --progress<span class="pl-pds">"</span></span></pre></div>
<p>现在我们执行<code>npm start</code> 看看效果。是不是看到打包的时候有百分比进度？在<code>http://localhost:8080/page1</code>页面刷新是不是没问题了？<br>
用手机通过局域网IP是否可以访问到网站？</p>
<p>参考地址：</p>
<ol>
<li><a href="https://segmentfault.com/a/1190000006670084" rel="nofollow">https://segmentfault.com/a/1190000006670084</a></li>
<li><a href="https://webpack.js.org/guides/development/#using-webpack-dev-server" rel="nofollow">https://webpack.js.org/guides/development/#using-webpack-dev-server</a></li>
</ol>
<h1><div id="hot-module-replacement">模块热替换（Hot Module Replacement）</div></h1>
<p>到目前，当我们修改代码的时候，浏览器会自动刷新，不信你可以去试试。（如果你的不会刷新，看看这个<a href="#editor">调整文本编辑器</a>）</p>
<p>我相信看这个教程的人，应该用过别人的框架。我们在修改代码的时候，浏览器不会刷新，只会更新自己修改的那一块。我们也要实现这个效果。</p>
<p>我们看下<a href="https://doc.webpack-china.org/guides/hot-module-replacement" rel="nofollow">webpack模块热替换</a>教程。</p>
<p>我们接下来要这么修改</p>
<p><code>package.json</code> 增加 <code>--hot</code></p>
<div class="bottom"><pre><span class="pl-s"><span class="pl-pds">"</span>start<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>webpack-dev-server --config webpack.dev.config.js --color --progress --hot<span class="pl-pds">"</span></span></pre></div>
<p><code>src/index.js</code> 增加<code>module.hot.accept()</code>,如下。当模块更新的时候，通知<code>index.js</code>。</p>
<p><code>src/index.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">ReactDom</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-dom<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">getRouter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./router/router<span class="pl-pds">'</span></span>;

<span class="pl-k">if</span> (<span class="pl-c1">module</span>.<span class="pl-smi">hot</span>) {
    <span class="pl-c1">module</span>.<span class="pl-smi">hot</span>.<span class="pl-c1">accept</span>();
}

<span class="pl-smi">ReactDom</span>.<span class="pl-en">render</span>(
    <span class="pl-en">getRouter</span>(), <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>app<span class="pl-pds">'</span></span>));
</pre></div>
<p>现在我们执行<code>npm start</code>，打开浏览器，修改<code>Home.js</code>,看是不是不刷新页面的情况下，内容更新了？惊不惊喜？意不意外？</p>
<p><strong>做模块热替换，我们只改了几行代码，非常简单的。纸老虎一个~</strong></p>
<p>现在我需要说明下我们命令行使用的<code>--hot</code>，可以通过配置<code>webpack.dev.config.js</code>来替换，<br>
向文档上那样,修改下面三处。但我们还是用<code>--hot</code>吧。下面的方式我们知道一下就行，我们不用。同样的效果。</p>
<div class="bottom"><pre><span class="pl-k">const</span> <span class="pl-c1">webpack</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack<span class="pl-pds">'</span></span>);

devServer<span class="pl-k">:</span> {
    hot<span class="pl-k">:</span> <span class="pl-c1">true</span>
}

plugins<span class="pl-k">:</span>[
     <span class="pl-k">new</span> <span class="pl-en">webpack.HotModuleReplacementPlugin</span>()
]</pre></div>
<p><code>HRM</code>配置其实有两种方式，一种<code>CLI</code>方式，一种<code>Node.js API</code>方式。我们用到的就是<code>CLI</code>方式，比较简单。<br>
<code>Node.js API</code>方式，就是建一个<code>server.js</code>等等，网上大部分教程都是这种方式，这里不做讲解了。</p>
<p>你以为模块热替换到这里就结束了？no<del>no</del>no~</p>
<p>上面的配置对<code>react</code>模块的支持不是很好哦。</p>
<p>例如下面的<code>demo</code>，当模块热替换的时候，<code>state</code>会重置，这不是我们想要的。</p>
<p>修改<code>Home.js</code>,增加计数<code>state</code></p>
<p><code>src/pages/Home/Home.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">class</span> <span class="pl-en">Home</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {
    <span class="pl-en">constructor</span>(<span class="pl-smi">props</span>) {
        <span class="pl-c1">super</span>(props);
        <span class="pl-c1">this</span>.<span class="pl-smi">state</span> <span class="pl-k">=</span> {
            count<span class="pl-k">:</span> <span class="pl-c1">0</span>
        }
    }

    <span class="pl-en">_handleClick</span>() {
        <span class="pl-c1">this</span>.<span class="pl-en">setState</span>({
            count<span class="pl-k">:</span> <span class="pl-k">++</span><span class="pl-c1">this</span>.<span class="pl-smi">state</span>.<span class="pl-smi">count</span>
        });
    }

    <span class="pl-en">render</span>() {
        <span class="pl-k">return</span> (
            <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
                <span class="pl-c1">this</span> is home<span class="pl-k">~</span><span class="pl-k">&lt;</span>br<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                当前计数：{<span class="pl-c1">this</span>.<span class="pl-smi">state</span>.<span class="pl-smi">count</span>}<span class="pl-k">&lt;</span>br<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>button onClick<span class="pl-k">=</span>{() <span class="pl-k">=&gt;</span> <span class="pl-c1">this</span>.<span class="pl-en">_handleClick</span>()}<span class="pl-k">&gt;</span>自增<span class="pl-k">&lt;</span><span class="pl-k">/</span>button<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        )
    }
}</pre></div>
<p>你可以测试一下，当我们修改代码的时候，<code>webpack</code>在更新页面的时候，也把<code>count</code>初始为0了。</p>
<p>为了在<code>react</code>模块更新的同时，能保留<code>state</code>等页面中其他状态，我们需要引入<a href="https://github.com/gaearon/react-hot-loader">react-hot-loader</a>~</p>
<p>Q:　请问<code>webpack-dev-server</code>与<code>react-hot-loader</code>两者的热替换有什么区别？</p>
<p>A:  区别在于<code>webpack-dev-serve</code>r自己的<code>--hot</code>模式只能即时刷新页面，但状态保存不住。因为<code>React</code>有一些自己语法(JSX)是<code>HotModuleReplacementPlugin</code>搞不定的。<br>
而<code>react-hot-loader</code>在<code>--hot</code>基础上做了额外的处理，来保证状态可以存下来。（来自<a href="https://segmentfault.com/q/1010000005612845" rel="nofollow">segmentfault</a>）</p>
<p>下面我们来加入<code>react-hot-loader v3</code>,</p>
<p>安装依赖</p>
<p><code>npm install react-hot-loader@next --save-dev</code></p>
<p>根据<a href="https://gaearon.github.io/react-hot-loader/getstarted/" rel="nofollow">文档</a>，<br>
我们要做如下几个修改~</p>
<ol>
<li><code>.babelrc</code> 增加 <code>react-hot-loader/babel</code></li>
</ol>
<p><code>.babelrc</code></p>
<div class="bottom"><pre>{
  <span class="pl-s"><span class="pl-pds">"</span>presets<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
    <span class="pl-s"><span class="pl-pds">"</span>es2015<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>react<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>stage-0<span class="pl-pds">"</span></span>
  ],
  <span class="pl-s"><span class="pl-pds">"</span>plugins<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
    <span class="pl-s"><span class="pl-pds">"</span>react-hot-loader/babel<span class="pl-pds">"</span></span>
  ]
}
</pre></div>
<ol>
<li><code>webpack.dev.config.js</code>入口增加<code>react-hot-loader/patch</code></li>
</ol>
<p><code>webpack.dev.config.js</code></p>
<div class="bottom"><pre>    entry<span class="pl-k">:</span> [
        <span class="pl-s"><span class="pl-pds">'</span>react-hot-loader/patch<span class="pl-pds">'</span></span>,
        <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/index.js<span class="pl-pds">'</span></span>)
    ]</pre></div>
<ol>
<li><code>src/index.js</code>修改如下</li>
</ol>
<p><code>src/index.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">ReactDom</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-dom<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> {<span class="pl-smi">AppContainer</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-hot-loader<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">getRouter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./router/router<span class="pl-pds">'</span></span>;

<span class="pl-c"><span class="pl-c">/*</span>初始化<span class="pl-c">*/</span></span>
<span class="pl-en">renderWithHotReload</span>(<span class="pl-en">getRouter</span>());

<span class="pl-c"><span class="pl-c">/*</span>热更新<span class="pl-c">*/</span></span>
<span class="pl-k">if</span> (<span class="pl-c1">module</span>.<span class="pl-smi">hot</span>) {
    <span class="pl-c1">module</span>.<span class="pl-smi">hot</span>.<span class="pl-c1">accept</span>(<span class="pl-s"><span class="pl-pds">'</span>./router/router<span class="pl-pds">'</span></span>, () <span class="pl-k">=&gt;</span> {
        <span class="pl-k">const</span> <span class="pl-c1">getRouter</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./router/router<span class="pl-pds">'</span></span>).<span class="pl-smi">default</span>;
        <span class="pl-en">renderWithHotReload</span>(<span class="pl-en">getRouter</span>());
    });
}

<span class="pl-k">function</span> <span class="pl-en">renderWithHotReload</span>(<span class="pl-smi">RootElement</span>) {
    <span class="pl-smi">ReactDom</span>.<span class="pl-en">render</span>(
        <span class="pl-k">&lt;</span>AppContainer<span class="pl-k">&gt;</span>
            {RootElement}
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>AppContainer<span class="pl-k">&gt;</span>,
        <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>app<span class="pl-pds">'</span></span>)
    )
}
</pre></div>
<p>现在，执行<code>npm start</code>，试试。是不是修改页面的时候，<code>state</code>不更新了？</p>
<p>参考文章：</p>
<ol>
<li><a class="issue-link js-issue-link" data-error-text="Failed to load issue title" data-id="149172267" data-permission-text="Issue title is private" data-url="https://github.com/gaearon/react-hot-loader/issues/243" data-hovercard-type="issue" data-hovercard-url="/gaearon/react-hot-loader/issues/243/hovercard" href="https://github.com/gaearon/react-hot-loader/issues/243">gaearon/react-hot-loader#243</a></li>
</ol>
<h1><div id="path">文件路径优化</div></h1>
<p>做到这里，我们简单休息下。做下优化~</p>
<p>在之前写的代码中，我们引用组件，或者页面时候，写的是相对路径~</p>
<p>比如<code>src/router/router.js</code>里面，引用<code>Home.js</code>的时候就用的相对路径</p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">Home</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../pages/Home/Home<span class="pl-pds">'</span></span>;</pre></div>
<p>webpack提供了一个别名配置，就是我们无论在哪个路径下，引用都可以这样</p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">Home</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>pages/Home/Home<span class="pl-pds">'</span></span>;</pre></div>
<p>下面我们来配置下，修改<code>webpack.dev.config.js</code>，增加别名~</p>
<p><code>webpack.dev.config.js</code></p>
<div class="bottom"><pre>    resolve<span class="pl-k">:</span> {
        alias<span class="pl-k">:</span> {
            pages<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/pages<span class="pl-pds">'</span></span>),
            component<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/component<span class="pl-pds">'</span></span>),
            router<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/router<span class="pl-pds">'</span></span>)
        }
    }</pre></div>
<p>然后我们把之前使用的绝对路径统统改掉。</p>
<p><code>src/router/router.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">Home</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>pages/Home/Home<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">Page1</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>pages/Page1/Page1<span class="pl-pds">'</span></span>;</pre></div>
<p><code>src/index.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">getRouter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>router/router<span class="pl-pds">'</span></span>;</pre></div>
<p>我们这里约定，下面，我们会默认配置需要的别名路径，不再做重复的讲述哦。</p>
<h1><div id="redux">redux</div></h1>
<p>接下来，我们就要就要就要集成<code>redux</code>了。</p>
<p>要对<code>redux</code>有一个大概的认识，可以阅读阮一峰前辈的<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" rel="nofollow">Redux 入门教程（一）：基本用法</a></p>
<p>如果要对<code>redux</code>有一个非常详细的认识，我推荐阅读<a href="http://cn.redux.js.org/index.html" rel="nofollow">中文文档</a>，写的非常好。读了这个教程，有一个非常深刻的感觉，<code>redux</code>并没有任何魔法。</p>
<p><strong>不要被各种关于 reducers, middleware, store 的演讲所蒙蔽 ---- Redux 实际是非常简单的。</strong></p>
<p>当然，我这篇文章是写给新手的，如果看不懂上面的文章，或者不想看，没关系。先会用，多用用就知道原理了。</p>
<p>开始整代码！我们就做一个最简单的计数器。自增，自减，重置。</p>
<p>先安装<code>redux</code> <code>npm install --save redux</code></p>
<p>初始化目录结构</p>
<div class="bottom"><pre>cd src
mkdir redux
cd redux
mkdir actions
mkdir reducers
touch <span class="pl-smi">reducers</span>.<span class="pl-smi">js</span>
touch <span class="pl-smi">store</span>.<span class="pl-smi">js</span>
touch actions<span class="pl-k">/</span><span class="pl-smi">counter</span>.<span class="pl-smi">js</span>
touch reducers<span class="pl-k">/</span><span class="pl-smi">counter</span>.<span class="pl-smi">js</span></pre></div>
<p>先来写<code>action</code>创建函数。<strong>通过<code>action</code>创建函数，可以创建<code>action</code>~</strong><br>
<code>src/redux/actions/counter.js</code></p>
<div class="bottom"><pre><span class="pl-c"><span class="pl-c">/*</span>action<span class="pl-c">*/</span></span>

<span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-c1">INCREMENT</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>counter/INCREMENT<span class="pl-pds">"</span></span>;
<span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-c1">DECREMENT</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>counter/DECREMENT<span class="pl-pds">"</span></span>;
<span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-c1">RESET</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>counter/RESET<span class="pl-pds">"</span></span>;

<span class="pl-k">export</span> <span class="pl-k">function</span> <span class="pl-en">increment</span>() {
    <span class="pl-k">return</span> {type<span class="pl-k">:</span> <span class="pl-c1">INCREMENT</span>}
}

<span class="pl-k">export</span> <span class="pl-k">function</span> <span class="pl-en">decrement</span>() {
    <span class="pl-k">return</span> {type<span class="pl-k">:</span> <span class="pl-c1">DECREMENT</span>}
}

<span class="pl-k">export</span> <span class="pl-k">function</span> <span class="pl-en">reset</span>() {
    <span class="pl-k">return</span> {type<span class="pl-k">:</span> <span class="pl-c1">RESET</span>}
}</pre></div>
<p>再来写<code>reducer</code>,<strong><code>reducer</code>是一个纯函数，接收<code>action</code>和旧的<code>state</code>,生成新的<code>state</code>.</strong></p>
<p><code>src/redux/reducers/counter.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> {<span class="pl-smi">INCREMENT</span>, <span class="pl-smi">DECREMENT</span>, <span class="pl-smi">RESET</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../actions/counter<span class="pl-pds">'</span></span>;

<span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c">* 初始化state</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>

<span class="pl-k">const</span> <span class="pl-c1">initState</span> <span class="pl-k">=</span> {
    count<span class="pl-k">:</span> <span class="pl-c1">0</span>
};
<span class="pl-c"><span class="pl-c">/*</span></span>
<span class="pl-c">* reducer</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>
<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">function</span> <span class="pl-en">reducer</span>(<span class="pl-smi">state</span> <span class="pl-k">=</span> <span class="pl-smi">initState</span>, <span class="pl-smi">action</span>) {
    <span class="pl-k">switch</span> (<span class="pl-smi">action</span>.<span class="pl-c1">type</span>) {
        <span class="pl-k">case</span> <span class="pl-c1">INCREMENT</span>:
            <span class="pl-k">return</span> {
                count<span class="pl-k">:</span> <span class="pl-smi">state</span>.<span class="pl-smi">count</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>
            };
        <span class="pl-k">case</span> <span class="pl-c1">DECREMENT</span>:
            <span class="pl-k">return</span> {
                count<span class="pl-k">:</span> <span class="pl-smi">state</span>.<span class="pl-smi">count</span> <span class="pl-k">-</span> <span class="pl-c1">1</span>
            };
        <span class="pl-k">case</span> <span class="pl-c1">RESET</span>:
            <span class="pl-k">return</span> {count<span class="pl-k">:</span> <span class="pl-c1">0</span>};
        <span class="pl-k">default</span>:
            <span class="pl-k">return</span> state
    }
}
</pre></div>
<p>一个项目有很多的<code>reducers</code>,我们要把他们整合到一起</p>
<p><code>src/redux/reducers.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">counter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./reducers/counter<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">function</span> <span class="pl-en">combineReducers</span>(<span class="pl-smi">state</span> <span class="pl-k">=</span> {}, <span class="pl-smi">action</span>) {
    <span class="pl-k">return</span> {
        counter<span class="pl-k">:</span> <span class="pl-en">counter</span>(<span class="pl-smi">state</span>.<span class="pl-smi">counter</span>, action)
    }
}</pre></div>
<p>到这里，我们必须再理解下一句话。</p>
<p><strong><code>reducer</code>就是纯函数，接收<code>state</code> 和 <code>action</code>，然后返回一个新的 <code>state</code>。</strong></p>
<p>看看上面的代码，无论是<code>combineReducers</code>函数也好，还是<code>reducer</code>函数也好，都是接收<code>state</code>和<code>action</code>，<br>
返回更新后的<code>state</code>。区别就是<code>combineReducers</code>函数是处理整棵树，<code>reducer</code>函数是处理树的某一点。</p>
<p>接下来，我们要创建一个<code>store</code>。</p>
<p>前面我们可以使用 <code>action</code> 来描述“发生了什么”，使用<code>action</code>创建函数来返回<code>action</code>。</p>
<p>还可以使用 <code>reducers</code> 来根据 <code>action</code> 更新 <code>state</code> 。</p>
<p>那我们如何提交<code>action</code>？提交的时候，怎么才能触发<code>reducers</code>呢？</p>
<p><code>store</code> 就是把它们联系到一起的对象。<code>store</code> 有以下职责：</p>
<ul>
<li>维持应用的 <code>state</code>；</li>
<li>提供 <code>getState()</code> 方法获取 <code>state</code>；</li>
<li>提供 <code>dispatch(action)</code> 触发<code>reducers</code>方法更新 <code>state</code>；</li>
<li>通过<code> subscribe(listener)</code> 注册监听器;</li>
<li>通过 <code>subscribe(listener)</code> 返回的函数注销监听器。</li>
</ul>
<p><code>src/redux/store.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> {<span class="pl-smi">createStore</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>redux<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">combineReducers</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./reducers.js<span class="pl-pds">'</span></span>;

<span class="pl-k">let</span> store <span class="pl-k">=</span> <span class="pl-en">createStore</span>(combineReducers);

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">store</span>;</pre></div>
<p>到现在为止，我们已经可以使用<code>redux</code>了~</p>
<p>下面我们就简单的测试下</p>
<div class="bottom"><pre>cd src
cd redux
touch <span class="pl-smi">testRedux</span>.<span class="pl-smi">js</span></pre></div>
<p><code>src/redux/testRedux.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> {<span class="pl-smi">increment</span>, <span class="pl-smi">decrement</span>, <span class="pl-smi">reset</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./actions/counter<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">store</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./store<span class="pl-pds">'</span></span>;

<span class="pl-c"><span class="pl-c">//</span> 打印初始状态</span>
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">store</span>.<span class="pl-en">getState</span>());

<span class="pl-c"><span class="pl-c">//</span> 每次 state 更新时，打印日志</span>
<span class="pl-c"><span class="pl-c">//</span> 注意 subscribe() 返回一个函数用来注销监听器</span>
<span class="pl-k">let</span> unsubscribe <span class="pl-k">=</span> <span class="pl-smi">store</span>.<span class="pl-en">subscribe</span>(() <span class="pl-k">=&gt;</span>
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">store</span>.<span class="pl-en">getState</span>())
);

<span class="pl-c"><span class="pl-c">//</span> 发起一系列 action</span>
<span class="pl-smi">store</span>.<span class="pl-en">dispatch</span>(<span class="pl-en">increment</span>());
<span class="pl-smi">store</span>.<span class="pl-en">dispatch</span>(<span class="pl-en">decrement</span>());
<span class="pl-smi">store</span>.<span class="pl-en">dispatch</span>(<span class="pl-en">reset</span>());

<span class="pl-c"><span class="pl-c">//</span> 停止监听 state 更新</span>
<span class="pl-en">unsubscribe</span>();</pre></div>
<p>当前文件夹执行命令</p>
<pre><code>webpack testRedux.js build.js

node build.js

</code></pre>
<p>是不是看到输出了<code>state</code>变化？</p>
<pre><code>{ counter: { count: 0 } }
{ counter: { count: 1 } }
{ counter: { count: 0 } }
{ counter: { count: 0 } }


</code></pre>
<p>做这个测试，就是为了告诉大家，<code>redux</code>和<code>react</code>没关系，虽说他俩能合作。</p>
<p>到这里，我建议你再理下<code>redux</code>的数据流，看看<a href="http://cn.redux.js.org/docs/basics/DataFlow.html" rel="nofollow">这里</a>。</p>
<ol>
<li>调用<code>store.dispatch(action)</code>提交<code>action</code>。</li>
<li><code>redux store</code>调用传入的<code>reducer</code>函数。把当前的<code>state</code>和<code>action</code>传进去。</li>
<li>根 <code>reducer</code> 应该把多个子 <code>reducer</code> 输出合并成一个单一的 <code>state</code> 树。</li>
<li><code>Redux store</code> 保存了根 <code>reducer</code> 返回的完整 <code>state</code> 树。</li>
</ol>
<p>就是酱紫~~</p>
<p>这会<code>webpack.dev.config.js</code>路径别名增加一下，后面好写了。</p>
<p><code>webpack.dev.config.js</code></p>
<div class="highlight highlight-source-json"><pre>          alias: {
              <span class="pl-ii">...</span>
              <span class="pl-ii">actions</span>: <span class="pl-ii">path.join(__dirname</span>, <span class="pl-ii">'src/redux/actions'),</span>
              <span class="pl-ii">reducers</span>: <span class="pl-ii">path.join(__dirname</span>, <span class="pl-ii">'src/redux/reducers'),</span>
              <span class="pl-ii">redux</span>: <span class="pl-ii">path.join(__dirname</span>, <span class="pl-ii">'src/redux')</span>
          }
  </pre></div>
<p>把前面的相对路径都改改。</p>
<p>下面我们开始搭配<code>react</code>使用。</p>
<p>写一个<code>Counter</code>页面</p>
<pre><code>cd src/pages
mkdir Counter
touch Counter/Counter.js

</code></pre>
<p><code>src/pages/Counter/Counter.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">class</span> <span class="pl-en">Counter</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {
    <span class="pl-en">render</span>() {
        <span class="pl-k">return</span> (
            <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>当前计数为(显示redux计数)<span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>button onClick<span class="pl-k">=</span>{() <span class="pl-k">=&gt;</span> {
                    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>调用自增函数<span class="pl-pds">'</span></span>);
                }}<span class="pl-k">&gt;</span>自增
                <span class="pl-k">&lt;</span><span class="pl-k">/</span>button<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>button onClick<span class="pl-k">=</span>{() <span class="pl-k">=&gt;</span> {
                    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>调用自减函数<span class="pl-pds">'</span></span>);
                }}<span class="pl-k">&gt;</span>自减
                <span class="pl-k">&lt;</span><span class="pl-k">/</span>button<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>button onClick<span class="pl-k">=</span>{() <span class="pl-k">=&gt;</span> {
                    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>调用重置函数<span class="pl-pds">'</span></span>);
                }}<span class="pl-k">&gt;</span>重置
                <span class="pl-k">&lt;</span><span class="pl-k">/</span>button<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        )
    }
}
</pre></div>
<p>修改路由，增加<code>Counter</code></p>
<p><code>src/router/router.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> {<span class="pl-smi">BrowserRouter</span> <span class="pl-k">as</span> <span class="pl-smi">Router</span>, <span class="pl-smi">Route</span>, <span class="pl-smi">Switch</span>, <span class="pl-smi">Link</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-router-dom<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">Home</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>pages/Home/Home<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">Page1</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>pages/Page1/Page1<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">Counter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>pages/Counter/Counter<span class="pl-pds">'</span></span>;

<span class="pl-k">const</span> <span class="pl-c1">getRouter</span> <span class="pl-k">=</span> () <span class="pl-k">=&gt;</span> (
    <span class="pl-k">&lt;</span>Router<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>ul<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>首页<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/page1<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>Page1<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/counter<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>Counter<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>ul<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>Switch<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route exact path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{Home}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/page1<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{Page1}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/counter<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{Counter}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>Switch<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>Router<span class="pl-k">&gt;</span>
);

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">getRouter</span>;</pre></div>
<p><code>npm start</code>看看效果。</p>
<p>下一步，我们让<code>Counter</code>组件和<code>Redux</code>联合起来。使<code>Counter</code>能获得到<code>Redux</code>的<code>state</code>，并且能发射<code>action</code>。</p>
<p>当然我们可以使用刚才测试<code>testRedux</code>的方法，手动监听~手动引入<code>store</code>~但是这肯定很麻烦哦。</p>
<p><code>react-redux</code>提供了一个方法<code>connect</code>。</p>
<blockquote>
<p>容器组件就是使用 store.subscribe() 从 Redux state 树中读取部分数据，并通过 props 来把这些数据提供给要渲染的组件。你可以手工来开发容器组件，但建议使用 React Redux 库的 connect() 方法来生成，这个方法做了性能优化来避免很多不必要的重复渲染。</p>
</blockquote>
<p><code>connect</code>接收两个参数，一个<code>mapStateToProps</code>,就是把<code>redux</code>的<code>state</code>，转为组件的<code>Props</code>，还有一个参数是<code>mapDispatchToprops</code>,<br>
就是把发射<code>actions</code>的方法，转为<code>Props</code>属性函数。</p>
<p>先来安装<code>react-redux</code></p>
<p><code>npm install --save react-redux</code></p>
<p><code>src/pages/Counter/Counter.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> {<span class="pl-smi">increment</span>, <span class="pl-smi">decrement</span>, <span class="pl-smi">reset</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>actions/counter<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> {<span class="pl-smi">connect</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-redux<span class="pl-pds">'</span></span>;

<span class="pl-k">class</span> <span class="pl-en">Counter</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {
    <span class="pl-en">render</span>() {
        <span class="pl-k">return</span> (
            <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>当前计数为{<span class="pl-c1">this</span>.<span class="pl-smi">props</span>.<span class="pl-smi">counter</span>.<span class="pl-smi">count</span>}<span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>button onClick<span class="pl-k">=</span>{() <span class="pl-k">=&gt;</span> <span class="pl-c1">this</span>.<span class="pl-smi">props</span>.<span class="pl-en">increment</span>()}<span class="pl-k">&gt;</span>自增
                <span class="pl-k">&lt;</span><span class="pl-k">/</span>button<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>button onClick<span class="pl-k">=</span>{() <span class="pl-k">=&gt;</span> <span class="pl-c1">this</span>.<span class="pl-smi">props</span>.<span class="pl-en">decrement</span>()}<span class="pl-k">&gt;</span>自减
                <span class="pl-k">&lt;</span><span class="pl-k">/</span>button<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>button onClick<span class="pl-k">=</span>{() <span class="pl-k">=&gt;</span> <span class="pl-c1">this</span>.<span class="pl-smi">props</span>.<span class="pl-c1">reset</span>()}<span class="pl-k">&gt;</span>重置
                <span class="pl-k">&lt;</span><span class="pl-k">/</span>button<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        )
    }
}

<span class="pl-k">const</span> <span class="pl-c1">mapStateToProps</span> <span class="pl-k">=</span> (<span class="pl-smi">state</span>) <span class="pl-k">=&gt;</span> {
    <span class="pl-k">return</span> {
        counter<span class="pl-k">:</span> <span class="pl-smi">state</span>.<span class="pl-smi">counter</span>
    }
};

<span class="pl-k">const</span> <span class="pl-c1">mapDispatchToProps</span> <span class="pl-k">=</span> (<span class="pl-smi">dispatch</span>) <span class="pl-k">=&gt;</span> {
    <span class="pl-k">return</span> {
        <span class="pl-en">increment</span><span class="pl-k">:</span> () <span class="pl-k">=&gt;</span> {
            <span class="pl-en">dispatch</span>(<span class="pl-en">increment</span>())
        },
        <span class="pl-en">decrement</span><span class="pl-k">:</span> () <span class="pl-k">=&gt;</span> {
            <span class="pl-en">dispatch</span>(<span class="pl-en">decrement</span>())
        },
        <span class="pl-en">reset</span><span class="pl-k">:</span> () <span class="pl-k">=&gt;</span> {
            <span class="pl-en">dispatch</span>(<span class="pl-en">reset</span>())
        }
    }
};

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">connect</span>(mapStateToProps, mapDispatchToProps)(Counter);</pre></div>
<p>下面我们要传入<code>store</code></p>
<blockquote>
<p>所有容器组件都可以访问 Redux store，所以可以手动监听它。一种方式是把它以 props 的形式传入到所有容器组件中。但这太麻烦了，因为必须要用 store 把展示组件包裹一层，仅仅是因为恰好在组件树中渲染了一个容器组件。</p>
</blockquote>
<blockquote>
<p>建议的方式是使用指定的 React Redux 组件  来 魔法般的 让所有容器组件都可以访问 store，而不必显示地传递它。只需要在渲染根组件时使用即可。</p>
</blockquote>
<p><code>src/index.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">ReactDom</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-dom<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> {<span class="pl-smi">AppContainer</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-hot-loader<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> {<span class="pl-smi">Provider</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-redux<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">store</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./redux/store<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">getRouter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>router/router<span class="pl-pds">'</span></span>;

<span class="pl-c"><span class="pl-c">/*</span>初始化<span class="pl-c">*/</span></span>
<span class="pl-en">renderWithHotReload</span>(<span class="pl-en">getRouter</span>());

<span class="pl-c"><span class="pl-c">/*</span>热更新<span class="pl-c">*/</span></span>
<span class="pl-k">if</span> (<span class="pl-c1">module</span>.<span class="pl-smi">hot</span>) {
    <span class="pl-c1">module</span>.<span class="pl-smi">hot</span>.<span class="pl-c1">accept</span>(<span class="pl-s"><span class="pl-pds">'</span>./router/router<span class="pl-pds">'</span></span>, () <span class="pl-k">=&gt;</span> {
        <span class="pl-k">const</span> <span class="pl-c1">getRouter</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>router/router<span class="pl-pds">'</span></span>).<span class="pl-smi">default</span>;
        <span class="pl-en">renderWithHotReload</span>(<span class="pl-en">getRouter</span>());
    });
}

<span class="pl-k">function</span> <span class="pl-en">renderWithHotReload</span>(<span class="pl-smi">RootElement</span>) {
    <span class="pl-smi">ReactDom</span>.<span class="pl-en">render</span>(
        <span class="pl-k">&lt;</span>AppContainer<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>Provider store<span class="pl-k">=</span>{store}<span class="pl-k">&gt;</span>
                {RootElement}
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>Provider<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>AppContainer<span class="pl-k">&gt;</span>,
        <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>app<span class="pl-pds">'</span></span>)
    )
}
</pre></div>
<p>到这里我们就可以执行<code>npm start</code>，打开localhost:8080/counter看效果了。</p>
<p><strong>但是你发现<code>npm start</code>一直报错</strong></p>
<div class="bottom"><pre><span class="pl-c1">ERROR</span> <span class="pl-k">in</span> .<span class="pl-k">/</span>node_modules<span class="pl-k">/</span>react<span class="pl-k">-</span>redux<span class="pl-k">/</span>es<span class="pl-k">/</span>connect<span class="pl-k">/</span><span class="pl-smi">mapDispatchToProps</span>.<span class="pl-smi">js</span>
Module not found<span class="pl-k">:</span> <span class="pl-c1">Error</span><span class="pl-k">:</span> Can<span class="pl-s"><span class="pl-pds">'</span>t resolve <span class="pl-pds">'</span></span>redux<span class="pl-s"><span class="pl-pds">'</span> in <span class="pl-pds">'</span></span><span class="pl-c1">F</span><span class="pl-k">:</span>\Project\react\react<span class="pl-k">-</span>family\node_modules\react<span class="pl-k">-</span>redux\es\connect<span class="pl-s"><span class="pl-pds">'</span></span>
<span class="pl-s"></span>
<span class="pl-s">ERROR in ./src/redux/store.js</span>
<span class="pl-s">Module not found: Error: Can<span class="pl-pds">'</span></span>t resolve <span class="pl-s"><span class="pl-pds">'</span>redux<span class="pl-pds">'</span></span> <span class="pl-k">in</span> <span class="pl-s"><span class="pl-pds">'</span>F:<span class="pl-cce">\P</span>roject<span class="pl-cce">\r</span>eact<span class="pl-cce">\r</span>eact-family<span class="pl-cce">\s</span>rc<span class="pl-cce">\r</span>edux<span class="pl-pds">'</span></span></pre></div>
<p>WTF？这个错误困扰了半天。我说下为什么造成这个错误。我们引用<code>redux</code>的时候这样用的</p>
<p><code>import {createStore} from 'redux'</code></p>
<p>然而，我们在<code>webapck.dev.config.js</code>里面这样配置了</p>
<div class="bottom"><pre>    resolve<span class="pl-k">:</span> {
        alias<span class="pl-k">:</span> {
            <span class="pl-k">...</span>
            redux<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/redux<span class="pl-pds">'</span></span>)
        }
    }</pre></div>
<p>然后<code>webapck</code>编译的时候碰到<code>redux</code>都去<code>src/redux</code>去找了。但是找不到啊。所以我们把<code>webpack.dev.config.js</code>里面<code>redux</code>这一行删除了，就好了。<br>
并且把使用我们自己使用<code>redux</code>文件夹的地方改成相对路径哦。</p>
<p>现在你可以<code>npm start</code>去看效果了。</p>
<p>这里我们再缕下（可以读<a href="http://taobaofed.org/blog/2016/08/18/react-redux-connect/" rel="nofollow">React 实践心得：react-redux 之 connect 方法详解</a>）</p>
<ol>
<li><code>Provider</code>组件是让所有的组件可以访问到<code>store</code>。不用手动去传。也不用手动去监听。</li>
<li><code>connect</code>函数作用是从 <code>Redux state</code> 树中读取部分数据，并通过 props 来把这些数据提供给要渲染的组件。也传递<code>dispatch(action)</code>函数到<code>props</code>。</li>
</ol>
<p>接下来，我们要说异步<code>action</code></p>
<p>参考地址： <a rel="nofollow" href="http://cn.redux.js.org/docs/advanced/AsyncActions.html">http://cn.redux.js.org/docs/advanced/AsyncActions.html</a></p>
<p>想象一下我们调用一个异步<code>get</code>请求去后台请求数据：</p>
<ol>
<li>请求开始的时候，界面转圈提示正在加载。<code>isLoading</code>置为<code>true</code>。</li>
<li>请求成功，显示数据。<code>isLoading</code>置为<code>false</code>,<code>data</code>填充数据。</li>
<li>请求失败，显示失败。<code>isLoading</code>置为<code>false</code>，显示错误信息。</li>
</ol>
<p>下面，我们以向后台请求用户基本信息为例。</p>
<ol>
<li>我们先创建一个<code>user.json</code>，等会请求用，相当于后台的API接口。</li>
</ol>
<div class="bottom"><pre>cd dist
mkdir api
cd api
touch <span class="pl-smi">user</span>.<span class="pl-smi">json</span></pre></div>
<p><code>dist/api/user.json</code></p>
<div class="bottom"><pre>{
  <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>brickspert<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>intro<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>please give me a star<span class="pl-pds">"</span></span>
}</pre></div>
<ol>
<li>创建必须的<code>action</code>创建函数。</li>
</ol>
<div class="bottom"><pre>cd src<span class="pl-k">/</span>redux<span class="pl-k">/</span>actions
touch <span class="pl-smi">userInfo</span>.<span class="pl-smi">js</span></pre></div>
<p><code>src/redux/actions/userInfo.js</code></p>
<div class="bottom"><pre><span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-c1">GET_USER_INFO_REQUEST</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>userInfo/GET_USER_INFO_REQUEST<span class="pl-pds">"</span></span>;
<span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-c1">GET_USER_INFO_SUCCESS</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>userInfo/GET_USER_INFO_SUCCESS<span class="pl-pds">"</span></span>;
<span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-c1">GET_USER_INFO_FAIL</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>userInfo/GET_USER_INFO_FAIL<span class="pl-pds">"</span></span>;

<span class="pl-k">function</span> <span class="pl-en">getUserInfoRequest</span>() {
    <span class="pl-k">return</span> {
        type<span class="pl-k">:</span> <span class="pl-c1">GET_USER_INFO_REQUEST</span>
    }
}

<span class="pl-k">function</span> <span class="pl-en">getUserInfoSuccess</span>(<span class="pl-smi">userInfo</span>) {
    <span class="pl-k">return</span> {
        type<span class="pl-k">:</span> <span class="pl-c1">GET_USER_INFO_SUCCESS</span>,
        userInfo<span class="pl-k">:</span> userInfo
    }
}

<span class="pl-k">function</span> <span class="pl-en">getUserInfoFail</span>() {
    <span class="pl-k">return</span> {
        type<span class="pl-k">:</span> <span class="pl-c1">GET_USER_INFO_FAIL</span>
    }
}</pre></div>
<p>我们创建了请求中，请求成功，请求失败三个<code>action</code>创建函数。</p>
<ol>
<li>创建<code>reducer</code></li>
</ol>
<p>再强调下，<code>reducer</code>是根据<code>state</code>和<code>action</code>生成新<code>state</code>的<strong>纯函数</strong>。</p>
<div class="bottom"><pre>cd src<span class="pl-k">/</span>redux<span class="pl-k">/</span>reducers
touch <span class="pl-smi">userInfo</span>.<span class="pl-smi">js</span></pre></div>
<p><code>src/redux/reducers/userInfo.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> {<span class="pl-smi">GET_USER_INFO_REQUEST</span>, <span class="pl-smi">GET_USER_INFO_SUCCESS</span>, <span class="pl-smi">GET_USER_INFO_FAIL</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>actions/userInfo<span class="pl-pds">'</span></span>;


<span class="pl-k">const</span> <span class="pl-c1">initState</span> <span class="pl-k">=</span> {
    isLoading<span class="pl-k">:</span> <span class="pl-c1">false</span>,
    userInfo<span class="pl-k">:</span> {},
    errorMsg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
};

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">function</span> <span class="pl-en">reducer</span>(<span class="pl-smi">state</span> <span class="pl-k">=</span> <span class="pl-smi">initState</span>, <span class="pl-smi">action</span>) {
    <span class="pl-k">switch</span> (<span class="pl-smi">action</span>.<span class="pl-c1">type</span>) {
        <span class="pl-k">case</span> <span class="pl-c1">GET_USER_INFO_REQUEST</span>:
            <span class="pl-k">return</span> {
                <span class="pl-k">...</span>state,
                isLoading<span class="pl-k">:</span> <span class="pl-c1">true</span>,
                userInfo<span class="pl-k">:</span> {},
                errorMsg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
            };
        <span class="pl-k">case</span> <span class="pl-c1">GET_USER_INFO_SUCCESS</span>:
            <span class="pl-k">return</span> {
                <span class="pl-k">...</span>state,
                isLoading<span class="pl-k">:</span> <span class="pl-c1">false</span>,
                userInfo<span class="pl-k">:</span> <span class="pl-smi">action</span>.<span class="pl-smi">userInfo</span>,
                errorMsg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
            };
        <span class="pl-k">case</span> <span class="pl-c1">GET_USER_INFO_FAIL</span>:
            <span class="pl-k">return</span> {
                <span class="pl-k">...</span>state,
                isLoading<span class="pl-k">:</span> <span class="pl-c1">false</span>,
                userInfo<span class="pl-k">:</span> {},
                errorMsg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>请求错误<span class="pl-pds">'</span></span>
            };
        <span class="pl-k">default</span>:
            <span class="pl-k">return</span> state;
    }
}</pre></div>
<p><strong>这里的<code>...state</code>语法，是和别人的<code>Object.assign()</code>起同一个作用，合并新旧state。我们这里是没效果的，但是我建议都写上这个哦</strong></p>
<p>组合<code>reducer</code></p>
<p><code>src/redux/reducers.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">counter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>reducers/counter<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">userInfo</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>reducers/userInfo<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">function</span> <span class="pl-en">combineReducers</span>(<span class="pl-smi">state</span> <span class="pl-k">=</span> {}, <span class="pl-smi">action</span>) {
    <span class="pl-k">return</span> {
        counter<span class="pl-k">:</span> <span class="pl-en">counter</span>(<span class="pl-smi">state</span>.<span class="pl-smi">counter</span>, action),
        userInfo<span class="pl-k">:</span> <span class="pl-en">userInfo</span>(<span class="pl-smi">state</span>.<span class="pl-smi">userInfo</span>, action)
    }
}</pre></div>
<ol>
<li>现在有了<code>action</code>，有了<code>reducer</code>，我们就需要调用把<code>action</code>里面的三个<code>action</code>函数和网络请求结合起来。
<ul>
<li>请求中 <code>dispatch getUserInfoRequest</code></li>
<li>请求成功 <code>dispatch getUserInfoSuccess</code></li>
<li>请求失败 <code>dispatch getUserInfoFail</code></li>
</ul>
</li>
</ol>
<p><code>src/redux/actions/userInfo.js</code>增加</p>
<div class="bottom"><pre><span class="pl-k">export</span> <span class="pl-k">function</span> <span class="pl-en">getUserInfo</span>() {
    <span class="pl-k">return</span> <span class="pl-k">function</span> (<span class="pl-smi">dispatch</span>) {
        <span class="pl-en">dispatch</span>(<span class="pl-en">getUserInfoRequest</span>());

        <span class="pl-k">return</span> <span class="pl-en">fetch</span>(<span class="pl-s"><span class="pl-pds">'</span>http://localhost:8080/api/user.json<span class="pl-pds">'</span></span>)
            .<span class="pl-c1">then</span>((<span class="pl-smi">response</span> <span class="pl-k">=&gt;</span> {
                <span class="pl-k">return</span> <span class="pl-smi">response</span>.<span class="pl-en">json</span>()
            }))
            .<span class="pl-c1">then</span>((<span class="pl-smi">json</span>) <span class="pl-k">=&gt;</span> {
                    <span class="pl-en">dispatch</span>(<span class="pl-en">getUserInfoSuccess</span>(json))
                }
            ).<span class="pl-c1">catch</span>(
                () <span class="pl-k">=&gt;</span> {
                    <span class="pl-en">dispatch</span>(<span class="pl-en">getUserInfoFail</span>());
                }
            )
    }
}</pre></div>
<p>我们这里发现，别的<code>action</code>创建函数都是返回<code>action</code>对象：</p>
<div class="bottom"><pre>{type<span class="pl-k">:</span> xxxx}</pre></div>
<p>但是我们现在的这个<code>action</code>创建函数 <code>getUserInfo</code>则是返回函数了。</p>
<p>为了让<code>action</code>创建函数除了返回<code>action</code>对象外，还可以返回函数，我们需要引用<code>redux-thunk</code>。</p>
<p><code>npm install --save redux-thunk</code></p>
<p>这里涉及到<code>redux</code>中间件<code>middleware</code>，我后面会讲到的。你也可以读这里<a href="http://cn.redux.js.org/docs/advanced/Middleware.html" rel="nofollow">Middleware</a>。</p>
<p>简单的说，中间件就是<code>action</code>在到达<code>reducer</code>，先经过中间件处理。我们之前知道<code>reducer</code>能处理的<code>action</code>只有这样的<code>{type:xxx}</code>，所以我们使用中间件来处理<br>
函数形式的<code>action</code>，把他们转为标准的<code>action</code>给<code>reducer</code>。这是<code>redux-thunk</code>的作用。<br>
使用<code>redux-thunk</code>中间件</p>
<p>我们来引入<code>redux-thunk</code>中间件</p>
<p><code>src/redux/store.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> {<span class="pl-smi">createStore</span>, <span class="pl-smi">applyMiddleware</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>redux<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">thunkMiddleware</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>redux-thunk<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">combineReducers</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./reducers.js<span class="pl-pds">'</span></span>;

<span class="pl-k">let</span> store <span class="pl-k">=</span> <span class="pl-en">createStore</span>(combineReducers, <span class="pl-en">applyMiddleware</span>(thunkMiddleware));

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">store</span>;</pre></div>
<p>到这里，<code>redux</code>这边OK了，我们来写个组件验证下。</p>
<div class="bottom"><pre>cd src<span class="pl-k">/</span>pages
mkdir UserInfo
cd UserInfo
touch <span class="pl-smi">UserInfo</span>.<span class="pl-smi">js</span></pre></div>
<p><code>src/pages/UserInfo/UserInfo.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> {<span class="pl-smi">connect</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-redux<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> {<span class="pl-smi">getUserInfo</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">"</span>actions/userInfo<span class="pl-pds">"</span></span>;

<span class="pl-k">class</span> <span class="pl-en">UserInfo</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {

    <span class="pl-en">render</span>() {
        <span class="pl-k">const</span> {<span class="pl-c1">userInfo</span>, <span class="pl-c1">isLoading</span>, <span class="pl-c1">errorMsg</span>} <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">props</span>.<span class="pl-smi">userInfo</span>;
        <span class="pl-k">return</span> (
            <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
                {
                    isLoading <span class="pl-k">?</span> <span class="pl-s"><span class="pl-pds">'</span>请求信息中......<span class="pl-pds">'</span></span> <span class="pl-k">:</span>
                        (
                            errorMsg <span class="pl-k">?</span> errorMsg <span class="pl-k">:</span>
                                <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
                                    <span class="pl-k">&lt;</span>p<span class="pl-k">&gt;</span>用户信息：<span class="pl-k">&lt;</span><span class="pl-k">/</span>p<span class="pl-k">&gt;</span>
                                    <span class="pl-k">&lt;</span>p<span class="pl-k">&gt;</span>用户名：{<span class="pl-smi">userInfo</span>.<span class="pl-c1">name</span>}<span class="pl-k">&lt;</span><span class="pl-k">/</span>p<span class="pl-k">&gt;</span>
                                    <span class="pl-k">&lt;</span>p<span class="pl-k">&gt;</span>介绍：{<span class="pl-smi">userInfo</span>.<span class="pl-smi">intro</span>}<span class="pl-k">&lt;</span><span class="pl-k">/</span>p<span class="pl-k">&gt;</span>
                                <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
                        )
                }
                <span class="pl-k">&lt;</span>button onClick<span class="pl-k">=</span>{() <span class="pl-k">=&gt;</span> <span class="pl-c1">this</span>.<span class="pl-smi">props</span>.<span class="pl-en">getUserInfo</span>()}<span class="pl-k">&gt;</span>请求用户信息<span class="pl-k">&lt;</span><span class="pl-k">/</span>button<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        )
    }
}

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">connect</span>((<span class="pl-smi">state</span>) <span class="pl-k">=&gt;</span> ({userInfo<span class="pl-k">:</span> <span class="pl-smi">state</span>.<span class="pl-smi">userInfo</span>}), {getUserInfo})(UserInfo);

</pre></div>
<p>这里你可能发现<code>connect</code>参数写法不一样了，<code>mapStateToProps</code>函数用了<code>es6</code>简写，<code>mapDispatchToProps</code>用了<code>react-redux</code>提供的简单写法。</p>
<p>增加路由<br>
<code>src/router/router.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> {<span class="pl-smi">BrowserRouter</span> <span class="pl-k">as</span> <span class="pl-smi">Router</span>, <span class="pl-smi">Route</span>, <span class="pl-smi">Switch</span>, <span class="pl-smi">Link</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-router-dom<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">Home</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>pages/Home/Home<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">Page1</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>pages/Page1/Page1<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">Counter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>pages/Counter/Counter<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">UserInfo</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>pages/UserInfo/UserInfo<span class="pl-pds">'</span></span>;

<span class="pl-k">const</span> <span class="pl-c1">getRouter</span> <span class="pl-k">=</span> () <span class="pl-k">=&gt;</span> (
    <span class="pl-k">&lt;</span>Router<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>ul<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>首页<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/page1<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>Page1<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/counter<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>Counter<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/userinfo<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>UserInfo<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>ul<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>Switch<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route exact path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{Home}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/page1<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{Page1}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/counter<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{Counter}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/userinfo<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{UserInfo}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>Switch<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>Router<span class="pl-k">&gt;</span>
);

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">getRouter</span>;</pre></div>
<p>现在你可以执行<code>npm start</code>去看效果啦！</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/0c5933060e6e1752261350747052191228ee4990/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f72656475782e706e67"><img src="https://camo.githubusercontent.com/0c5933060e6e1752261350747052191228ee4990/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f72656475782e706e67" alt="redux" data-canonical-src="http://oqcb8djlw.bkt.clouddn.com/redux.png" style="max-width:100%;"></a></p>
<p>到这里<code>redux</code>集成基本告一段落了，后面我们还会有一些优化。</p>
<h2>combinReducers优化</h2>
<p><code>redux</code>提供了一个<code>combineReducers</code>函数来合并<code>reducer</code>，不用我们自己合并哦。写起来简单，但是意思和我们<br>
自己写的<code>combinReducers</code>也是一样的。</p>
<p><code>src/redux/reducers.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> {<span class="pl-smi">combineReducers</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">"</span>redux<span class="pl-pds">"</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">counter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>reducers/counter<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">userInfo</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>reducers/userInfo<span class="pl-pds">'</span></span>;


<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">combineReducers</span>({
    counter,
    userInfo
});</pre></div>
<h1><div id="devtool">devtool优化</div></h1>
<p>现在我们发现一个问题，代码哪里写错了，浏览器报错只报在<code>build.js</code>第几行。</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/f938c838265055b480e5a4902c0e6407b46c30f4/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f6572726f722d6275696c642e706e67"><img src="https://camo.githubusercontent.com/f938c838265055b480e5a4902c0e6407b46c30f4/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f6572726f722d6275696c642e706e67" alt="错误图片" data-canonical-src="http://oqcb8djlw.bkt.clouddn.com/error-build.png" style="max-width:100%;"></a></p>
<p>这让我们分析错误无从下手。看<a href="https://doc.webpack-china.org/configuration/devtool" rel="nofollow">这里</a>。</p>
<p>我们增加<code>webpack</code>配置<code>devtool</code>！</p>
<p><code>webpack.dev.config.js</code>增加</p>
<div class="bottom"><pre>devtool<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>inline-source-map<span class="pl-pds">'</span></span></pre></div>
<p>这次看错误信息是不是提示的很详细了？</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/af2786344ccdd42dc3892f41ffac682ae84a284b/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f6572726f722d6275696c642d322e706e67"><img src="https://camo.githubusercontent.com/af2786344ccdd42dc3892f41ffac682ae84a284b/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f6572726f722d6275696c642d322e706e67" alt="错误图片" data-canonical-src="http://oqcb8djlw.bkt.clouddn.com/error-build-2.png" style="max-width:100%;"></a></p>
<p>同时，我们在<code>srouce</code>里面能看到我们写的代码，也能打断点调试哦~</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/f28c34ecd0e1bae80d51fc0e14fc614c3681e327/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f736f757263652e706e67"><img src="https://camo.githubusercontent.com/f28c34ecd0e1bae80d51fc0e14fc614c3681e327/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f736f757263652e706e67" alt="错误图片" data-canonical-src="http://oqcb8djlw.bkt.clouddn.com/source.png" style="max-width:100%;"></a></p>
<h1><div id="css">编译css</div></h1>
<p>先说这里为什么不用<code>scss</code>，因为<code>Windows</code>使用<code>node-sass</code>，需要先安装<a href="https://www.microsoft.com/en-us/download/details.aspx?id=8279" rel="nofollow"> Microsoft Windows SDK for Windows 7 and .NET Framework 4</a>。<br>
我怕有些人copy这份代码后，没注意，运行不起来。所以这里不用<code>scss</code>了，如果需要，自行编译哦。</p>
<p><code>npm install css-loader style-loader --save-dev</code></p>
<p><code>css-loader</code>使你能够使用类似<code>@import</code> 和 <code>url(...)</code>的方法实现 <code>require()</code>的功能；</p>
<p><code>style-loader</code>将所有的计算后的样式加入页面中； 二者组合在一起使你能够把样式表嵌入<code>webpack</code>打包后的JS文件中。</p>
<p><code>webpack.dev.config.js</code> <code>rules</code>增加</p>
<div class="bottom"><pre>{
   test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>css<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
   use<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>style-loader<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>css-loader<span class="pl-pds">'</span></span>]
}</pre></div>
<p>我们用<code>Page1</code>页面来测试下</p>
<div class="bottom"><pre>cd src<span class="pl-k">/</span>pages<span class="pl-k">/</span>Page1
touch <span class="pl-smi">Page1</span>.<span class="pl-smi">css</span></pre></div>
<p><code>src/pages/Page1/Page1.css</code></p>
<div class="bottom"><pre>.<span class="pl-smi">page</span><span class="pl-k">-</span>box {
    border<span class="pl-k">:</span> <span class="pl-ii">1px</span> solid red;
}</pre></div>
<p><code>src/pages/Page1/Page1.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">'</span>./Page1.css<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">class</span> <span class="pl-en">Page1</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {
    <span class="pl-en">render</span>() {
        <span class="pl-k">return</span> (
            <span class="pl-k">&lt;</span>div className<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>page-box<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
                <span class="pl-c1">this</span> is page1<span class="pl-k">~</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        )
    }
}</pre></div>
<p>好了，现在<code>npm start</code>去看效果吧。</p>
<h1><div id="image">编译图片</div></h1>
<p><code>npm install --save-dev url-loader file-loader</code></p>
<p><code>webpack.dev.config.js</code> <code>rules</code>增加</p>
<div class="bottom"><pre>{
    test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>(png<span class="pl-k">|</span>jpg<span class="pl-k">|</span>gif)<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
    use<span class="pl-k">:</span> [{
        loader<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>url-loader<span class="pl-pds">'</span></span>,
        options<span class="pl-k">:</span> {
            limit<span class="pl-k">:</span> <span class="pl-c1">8192</span>
        }
    }]
}</pre></div>
<p><code>options limit 8192</code>意思是，小于等于8K的图片会被转成<code>base64</code>编码，直接插入HTML中，减少<code>HTTP</code>请求。</p>
<p>我们来用<code>Page1</code> 测试下</p>
<div class="bottom"><pre>cd src<span class="pl-k">/</span>pages<span class="pl-k">/</span>Page1
mkdir images</pre></div>
<p>给<code>images</code>文件夹放一个图片。</p>
<p>修改代码，引用图片</p>
<p><code>src/pages/Page1/Page1.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">'</span>./Page1.css<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">image</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./images/brickpsert.jpg<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">class</span> <span class="pl-en">Page1</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {
    <span class="pl-en">render</span>() {
        <span class="pl-k">return</span> (
            <span class="pl-k">&lt;</span>div className<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>page-box<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
                <span class="pl-c1">this</span> is page1<span class="pl-k">~</span>
                <span class="pl-k">&lt;</span>img src<span class="pl-k">=</span>{image}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        )
    }
}</pre></div>
<p>可以去看看效果啦。</p>
<h1><div id="code-split">按需加载</div></h1>
<p>为什么要实现按需加载？</p>
<p>我们现在看到，打包完后，所有页面只生成了一个<code>build.js</code>,当我们首屏加载的时候，就会很慢。因为他也下载了别的页面的<code>js</code>了哦。</p>
<p>如果每个页面都打包了自己单独的JS，在进入自己页面的时候才加载对应的js，那首屏加载就会快很多哦。</p>
<p>在 <code>react-router 2.0</code>时代， 按需加载需要用到的最关键的一个函数，就是<code>require.ensure()</code>，它是按需加载能够实现的核心。</p>
<p>在4.0版本，官方放弃了这种处理按需加载的方式，选择了一个更加简洁的处理方式。</p>
<p><a href="https://reacttraining.com/react-router/web/guides/code-splitting" rel="nofollow">传送门</a></p>
<p>根据官方示例，我们开搞</p>
<ol>
<li><code>npm install bundle-loader --save-dev</code></li>
<li>新建<code>bundle.js</code></li>
</ol>
<div class="bottom"><pre>cd src<span class="pl-k">/</span>router
touch <span class="pl-smi">Bundle</span>.<span class="pl-smi">js</span></pre></div>
<p><code>src/router/Bundle.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>

<span class="pl-k">class</span> <span class="pl-en">Bundle</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {
    state <span class="pl-k">=</span> {
        <span class="pl-c"><span class="pl-c">//</span> short for "module" but that's a keyword in js, so "mod"</span>
        mod<span class="pl-k">:</span> <span class="pl-c1">null</span>
    };

    <span class="pl-en">componentWillMount</span>() {
        <span class="pl-c1">this</span>.<span class="pl-c1">load</span>(<span class="pl-c1">this</span>.<span class="pl-smi">props</span>)
    }

    <span class="pl-en">componentWillReceiveProps</span>(<span class="pl-smi">nextProps</span>) {
        <span class="pl-k">if</span> (<span class="pl-smi">nextProps</span>.<span class="pl-smi">load</span> <span class="pl-k">!==</span> <span class="pl-c1">this</span>.<span class="pl-smi">props</span>.<span class="pl-smi">load</span>) {
            <span class="pl-c1">this</span>.<span class="pl-c1">load</span>(nextProps)
        }
    }

    <span class="pl-en">load</span>(<span class="pl-smi">props</span>) {
        <span class="pl-c1">this</span>.<span class="pl-en">setState</span>({
            mod<span class="pl-k">:</span> <span class="pl-c1">null</span>
        });
        <span class="pl-smi">props</span>.<span class="pl-c1">load</span>((<span class="pl-smi">mod</span>) <span class="pl-k">=&gt;</span> {
            <span class="pl-c1">this</span>.<span class="pl-en">setState</span>({
                <span class="pl-c"><span class="pl-c">//</span> handle both es imports and cjs</span>
                mod<span class="pl-k">:</span> <span class="pl-smi">mod</span>.<span class="pl-smi">default</span> <span class="pl-k">?</span> <span class="pl-smi">mod</span>.<span class="pl-smi">default</span> <span class="pl-k">:</span> mod
            })
        })
    }

    <span class="pl-en">render</span>() {
        <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">props</span>.<span class="pl-en">children</span>(<span class="pl-c1">this</span>.<span class="pl-smi">state</span>.<span class="pl-smi">mod</span>)
    }
}

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">Bundle</span>;</pre></div>
<ol>
<li>改造路由器</li>
</ol>
<p><code>src/router/router.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> {<span class="pl-smi">BrowserRouter</span> <span class="pl-k">as</span> <span class="pl-smi">Router</span>, <span class="pl-smi">Route</span>, <span class="pl-smi">Switch</span>, <span class="pl-smi">Link</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-router-dom<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">Bundle</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./Bundle<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">Home</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>bundle-loader?lazy&amp;name=home!pages/Home/Home<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">Page1</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>bundle-loader?lazy&amp;name=page1!pages/Page1/Page1<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">Counter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>bundle-loader?lazy&amp;name=counter!pages/Counter/Counter<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">UserInfo</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>bundle-loader?lazy&amp;name=userInfo!pages/UserInfo/UserInfo<span class="pl-pds">'</span></span>;

<span class="pl-k">const</span> <span class="pl-c1">Loading</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () {
    <span class="pl-k">return</span> <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>Loading<span class="pl-k">...</span><span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
};

<span class="pl-k">const</span> <span class="pl-c1">createComponent</span> <span class="pl-k">=</span> (<span class="pl-smi">component</span>) <span class="pl-k">=&gt;</span> (<span class="pl-smi">props</span>) <span class="pl-k">=&gt;</span> (
    <span class="pl-k">&lt;</span>Bundle load<span class="pl-k">=</span>{component}<span class="pl-k">&gt;</span>
        {
            (<span class="pl-smi">Component</span>) <span class="pl-k">=&gt;</span> Component <span class="pl-k">?</span> <span class="pl-k">&lt;</span>Component {<span class="pl-k">...</span>props} <span class="pl-k">/</span><span class="pl-k">&gt;</span> <span class="pl-k">:</span> <span class="pl-k">&lt;</span>Loading<span class="pl-k">/</span><span class="pl-k">&gt;</span>
        }
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>Bundle<span class="pl-k">&gt;</span>
);

<span class="pl-k">const</span> <span class="pl-c1">getRouter</span> <span class="pl-k">=</span> () <span class="pl-k">=&gt;</span> (
    <span class="pl-k">&lt;</span>Router<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>ul<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>首页<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/page1<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>Page1<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/counter<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>Counter<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>li<span class="pl-k">&gt;&lt;</span>Link to<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/userinfo<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>UserInfo<span class="pl-k">&lt;</span><span class="pl-k">/</span>Link<span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>ul<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>Switch<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route exact path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{<span class="pl-en">createComponent</span>(Home)}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/page1<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{<span class="pl-en">createComponent</span>(Page1)}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/counter<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{<span class="pl-en">createComponent</span>(Counter)}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Route path<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/userinfo<span class="pl-pds">"</span></span> component<span class="pl-k">=</span>{<span class="pl-en">createComponent</span>(UserInfo)}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>Switch<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>Router<span class="pl-k">&gt;</span>
);

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">getRouter</span>;</pre></div>
<p>现在你可以<code>npm start</code>，打开浏览器，看是不是进入新的页面，都会加载自己的JS的~</p>
<p>但是你可能发现，名字都是<code>0.bundle.js</code>这样子的，这分不清楚是哪个页面的<code>js</code>呀！</p>
<p>我们修改下<code>webpack.dev.config.js</code>,加个<code>chunkFilename</code>。<code>chunkFilename</code>是除了<code>entry</code>定义的入口<code>js</code>之外的<code>js</code>~</p>
<div class="bottom"><pre>    output<span class="pl-k">:</span> {
        path<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>./dist<span class="pl-pds">'</span></span>),
        filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>bundle.js<span class="pl-pds">'</span></span>,
        chunkFilename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].js<span class="pl-pds">'</span></span>
    }</pre></div>
<p>现在你运行发现名字变成<code>home.js</code>,这样的了。棒棒哒！</p>
<p>那么问题来了<code>home</code>是在哪里设置的？<code>webpack</code>怎么知道他叫<code>home</code>？</p>
<p>其实在这里我们定义了，<code>router.js</code>里面</p>
<p><code>import Home from 'bundle-loader?lazy&amp;name=home!pages/Home/Home';</code></p>
<p>看到没。这里有个<code>name=home</code>。嘿嘿。</p>
<p>参考地址：</p>
<ol>
<li><a href="http://www.jianshu.com/p/8dd98a7028e0" rel="nofollow">http://www.jianshu.com/p/8dd98a7028e0</a></li>
<li><a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/docs/guides/code-splitting.md">https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/docs/guides/code-splitting.md</a></li>
<li><a href="https://segmentfault.com/a/1190000007949841" rel="nofollow">https://segmentfault.com/a/1190000007949841</a></li>
<li><a href="http://react-china.org/t/webpack-react-router/10123" rel="nofollow">http://react-china.org/t/webpack-react-router/10123</a></li>
<li><a href="https://juejin.im/post/58f9717e44d9040069d06cd6" rel="nofollow">https://juejin.im/post/58f9717e44d9040069d06cd6</a></li>
</ol>
<h1><div id="cache">缓存</div></h1>
<p>想象一下这个场景~</p>
<p>我们网站上线了，用户第一次访问首页，下载了<code>home.js</code>，第二次访问又下载了<code>home.js</code>~</p>
<p>这肯定不行呀，所以我们一般都会做一个缓存，用户下载一次<code>home.js</code>后，第二次就不下载了。</p>
<p>有一天，我们更新了<code>home.js</code>，但是用户不知道呀，用户还是使用本地旧的<code>home.js</code>。出问题了~</p>
<p>怎么解决？每次代码更新后，打包生成的名字不一样。比如第一次叫<code>home.a.js</code>，第二次叫<code>home.b.js</code>。</p>
<p>文档<a href="https://doc.webpack-china.org/guides/caching" rel="nofollow">看这里</a></p>
<p>我们照着文档来</p>
<p><code>webpack.dev.config.js</code></p>
<div class="bottom"><pre>    output<span class="pl-k">:</span> {
        path<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>./dist<span class="pl-pds">'</span></span>),
        filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].[hash].js<span class="pl-pds">'</span></span>,
        chunkFilename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].[chunkhash].js<span class="pl-pds">'</span></span>
    }</pre></div>
<p>每次打包都用增加<code>hash</code>~</p>
<p>现在我们试试，是不是修改了文件，打包后相应的文件名字就变啦？</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/e9c041242d52d16bc841253126000ef029ebfd99/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f7061636b6167652e706e67"><img src="https://camo.githubusercontent.com/e9c041242d52d16bc841253126000ef029ebfd99/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f7061636b6167652e706e67" alt="package" data-canonical-src="http://oqcb8djlw.bkt.clouddn.com/package.png" style="max-width:100%;"></a></p>
<p>但是你可能发现了，网页打开报错了~因为你<code>dist/index.html</code>里面引用<code>js</code>名字还是<code>bundle.js</code>老名字啊,改成新的名字就可以啦。</p>
<p>啊~那岂不是我每次编译打包，都得去改一下js名字？欲知后事如何，且看下节分享。</p>
<h1><div id="htmlwebpackplugin">HtmlWebpackPlugin</div></h1>
<p>这个插件，每次会自动把js插入到你的模板<code>index.html</code>里面去。</p>
<p><code>npm install html-webpack-plugin --save-dev</code></p>
<p>新建模板<code>index.html</code></p>
<div class="bottom"><pre>cd src
touch <span class="pl-smi">index</span>.<span class="pl-smi">html</span></pre></div>
<p><code>src/index.html</code></p>
<div class="bottom"><pre><span class="pl-k">&lt;</span><span class="pl-k">!</span>doctype html<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>html lang<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>en<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>head<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>meta charset<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>title<span class="pl-k">&gt;</span><span class="pl-c1">Document</span><span class="pl-k">&lt;</span><span class="pl-k">/</span>title<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span><span class="pl-k">/</span>head<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>body<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>div id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>app<span class="pl-pds">"</span></span><span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span><span class="pl-k">/</span>body<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span><span class="pl-k">/</span>html<span class="pl-k">&gt;</span></pre></div>
<p>修改<code>webpack.dev.config.js</code>，增加<code>plugin</code></p>
<div class="bottom"><pre><span class="pl-k">var</span> HtmlWebpackPlugin <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>html-webpack-plugin<span class="pl-pds">'</span></span>);

    plugins<span class="pl-k">:</span> [<span class="pl-k">new</span> <span class="pl-en">HtmlWebpackPlugin</span>({
        filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>index.html<span class="pl-pds">'</span></span>,
        template<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/index.html<span class="pl-pds">'</span></span>)
    })],</pre></div>
<p><code>npm start</code>运行项目，看看是不是能正常访问啦。~</p>
<p>说明一下：<code>npm start</code>打包后的文件存在内存中，你看不到的。~ 你可以把遗留<code>dist/index.html</code>删除掉了。</p>
<h1><div id="common-code">提取公共代码</div></h1>
<p>想象一下，我们的主文件，原来的<code>bundle.js</code>里面是不是包含了<code>react</code>,<code>redux</code>,<code>react-router</code>等等<br>
这些代码？？这些代码基本上不会改变的。但是，他们合并在<code>bundle.js</code>里面，每次项目发布，重新请求<code>bundle.js</code>的时候，相当于重新请求了<br>
<code>react</code>等这些公共库。浪费了~</p>
<p>我们把<code>react</code>这些不会改变的公共库提取出来，用户缓存下来。从此以后，用户再也不用下载这些库了，无论是否发布项目。嘻嘻。</p>
<p><code>webpack</code>文档给了教程，<a href="https://doc.webpack-china.org/guides/caching#-extracting-boilerplate-" rel="nofollow">看这里</a></p>
<p><code>webpack.dev.config.js</code></p>
<div class="bottom"><pre>    <span class="pl-k">var</span> webpack <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack<span class="pl-pds">'</span></span>);

    entry<span class="pl-k">:</span> {
        app<span class="pl-k">:</span> [
            <span class="pl-s"><span class="pl-pds">'</span>react-hot-loader/patch<span class="pl-pds">'</span></span>,
            <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/index.js<span class="pl-pds">'</span></span>)
        ],
        vendor<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>react-router-dom<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>redux<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>react-dom<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>react-redux<span class="pl-pds">'</span></span>]
    }
    
        <span class="pl-c"><span class="pl-c">/*</span>plugins<span class="pl-c">*/</span></span>
        <span class="pl-k">new</span> <span class="pl-en">webpack.optimize.CommonsChunkPlugin</span>({
            name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>vendor<span class="pl-pds">'</span></span>
        })</pre></div>
<p>把<code>react</code>等库生成打包到<code>vendor.hash.js</code>里面去。</p>
<p>但是你现在可能发现编译生成的文件<code>app.[hash].js</code>和<code>vendor.[hash].js</code>生成的<code>hash</code>一样的，这里是个问题，因为呀，你每次修改代码,都会导致<code>vendor.[hash].js</code>名字改变，那我们提取出来的意义也就没了。其实文档上写的很清楚，</p>
<div class="bottom"><pre>   output<span class="pl-k">:</span> {
        path<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>./dist<span class="pl-pds">'</span></span>),
        filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].[hash].js<span class="pl-pds">'</span></span>, <span class="pl-c"><span class="pl-c">//</span>这里应该用chunkhash替换hash</span>
        chunkFilename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].[chunkhash].js<span class="pl-pds">'</span></span>
    }</pre></div>
<p>但是无奈，如果用<code>chunkhash</code>，会报错。和<code>webpack-dev-server --hot</code>不兼容，具体<a href="https://github.com/webpack/webpack-dev-server/issues/377" data-hovercard-type="issue" data-hovercard-url="/webpack/webpack-dev-server/issues/377/hovercard">看这里</a>。</p>
<p>现在我们在配置开发版配置文件，就向<code>webpack-dev-server</code>妥协，因为我们要用他。问题先放这里，等会我们配置正式版<code>webpack.config.js</code>的时候要解决这个问题。</p>
<h1><div id="product">生产坏境构建</div></h1>
<blockquote>
<p>开发环境(development)和生产环境(production)的构建目标差异很大。在开发环境中，我们需要具有强大的、具有实时重新加载(live reloading)或热模块替换(hot module replacement)能力的 source map 和 localhost server。而在生产环境中，我们的目标则转向于关注更小的 bundle，更轻量的 source map，以及更优化的资源，以改善加载时间。由于要遵循逻辑分离，我们通常建议为每个环境编写彼此独立的 webpack 配置。</p>
</blockquote>
<p>文档<a href="https://doc.webpack-china.org/guides/production" rel="nofollow">看这里</a></p>
<p>我们要开始做了~</p>
<div class="bottom"><pre>touch <span class="pl-smi">webpack</span>.<span class="pl-smi">config</span>.<span class="pl-smi">js</span></pre></div>
<p>在<code>webpack.dev.config.js</code>的基础上先做以下几个修改~</p>
<ol>
<li>先删除<code>webpack-dev-server</code>相关的东西~</li>
<li><code>devtool</code>的值改成<code>cheap-module-source-map</code></li>
<li>刚才说的<code>hash</code>改成<code>chunkhash</code></li>
</ol>
<p><code>webpack.config.js</code></p>
<div class="bottom"><pre><span class="pl-k">const</span> <span class="pl-c1">path</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> HtmlWebpackPlugin <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>html-webpack-plugin<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> webpack <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack<span class="pl-pds">'</span></span>);

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> {
    devtool<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>cheap-module-source-map<span class="pl-pds">'</span></span>,
    entry<span class="pl-k">:</span> {
        app<span class="pl-k">:</span> [
            <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/index.js<span class="pl-pds">'</span></span>)
        ],
        vendor<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>react-router-dom<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>redux<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>react-dom<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>react-redux<span class="pl-pds">'</span></span>]
    },
    output<span class="pl-k">:</span> {
        path<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>./dist<span class="pl-pds">'</span></span>),
        filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].[chunkhash].js<span class="pl-pds">'</span></span>,
        chunkFilename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].[chunkhash].js<span class="pl-pds">'</span></span>
    },
    module<span class="pl-k">:</span> {
        rules<span class="pl-k">:</span> [{
            test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>js<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
            use<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>babel-loader<span class="pl-pds">'</span></span>],
            include<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src<span class="pl-pds">'</span></span>)
        }, {
            test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>css<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
            use<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>style-loader<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>css-loader<span class="pl-pds">'</span></span>]
        }, {
            test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>(png<span class="pl-k">|</span>jpg<span class="pl-k">|</span>gif)<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
            use<span class="pl-k">:</span> [{
                loader<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>url-loader<span class="pl-pds">'</span></span>,
                options<span class="pl-k">:</span> {
                    limit<span class="pl-k">:</span> <span class="pl-c1">8192</span>
                }
            }]
        }]
    },
    plugins<span class="pl-k">:</span> [
        <span class="pl-k">new</span> <span class="pl-en">HtmlWebpackPlugin</span>({
            filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>index.html<span class="pl-pds">'</span></span>,
            template<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/index.html<span class="pl-pds">'</span></span>)
        }),
        <span class="pl-k">new</span> <span class="pl-en">webpack.optimize.CommonsChunkPlugin</span>({
            name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>vendor<span class="pl-pds">'</span></span>
        })
    ],

    resolve<span class="pl-k">:</span> {
        alias<span class="pl-k">:</span> {
            pages<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/pages<span class="pl-pds">'</span></span>),
            component<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/component<span class="pl-pds">'</span></span>),
            router<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/router<span class="pl-pds">'</span></span>),
            actions<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/redux/actions<span class="pl-pds">'</span></span>),
            reducers<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/redux/reducers<span class="pl-pds">'</span></span>)
        }
    }
};</pre></div>
<p>在<code>package.json</code>增加打包脚本</p>
<p><code>"build":"webpack --config webpack.config.js"</code></p>
<p>然后执行<code>npm run build</code>~看看<code>dist</code>文件夹是不是生成了我们发布要用的所有文件哦？</p>
<p>接下来我们还是要优化正式版配置文件~</p>
<h1><div id="uglify">文件压缩</div></h1>
<p><code>webpack</code>使用<code>UglifyJSPlugin</code>来压缩生成的文件。</p>
<p><code>npm i --save-dev uglifyjs-webpack-plugin</code></p>
<p><code>webpack.config.js</code></p>
<div class="bottom"><pre><span class="pl-k">const</span> <span class="pl-c1">UglifyJSPlugin</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>uglifyjs-webpack-plugin<span class="pl-pds">'</span></span>)

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> {
  plugins<span class="pl-k">:</span> [
    <span class="pl-k">new</span> <span class="pl-en">UglifyJSPlugin</span>()
  ]
}</pre></div>
<p><code>npm run build</code>发现打包文件大小减小了好多。</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/b8635df066a19aba692872f69ffd11efefa70ff7/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f75676c6966792e706e67"><img src="https://camo.githubusercontent.com/b8635df066a19aba692872f69ffd11efefa70ff7/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f75676c6966792e706e67" alt="uglify" data-canonical-src="http://oqcb8djlw.bkt.clouddn.com/uglify.png" style="max-width:100%;"></a></p>
<h1><div id="env">指定环境</div></h1>
<blockquote>
<p>许多 library 将通过与 process.env.NODE_ENV 环境变量关联，以决定 library 中应该引用哪些内容。例如，当不处于生产环境中时，某些 library 为了使调试变得容易，可能会添加额外的日志记录(log)和测试(test)。其实，当使用 process.env.NODE_ENV === 'production' 时，一些 library 可能针对具体用户的环境进行代码优化，从而删除或添加一些重要代码。我们可以使用 webpack 内置的 DefinePlugin 为所有的依赖定义这个变量：</p>
</blockquote>
<p><code>webpack.config.js</code></p>
<div class="bottom"><pre><span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> {
  plugins<span class="pl-k">:</span> [
       <span class="pl-k">new</span> <span class="pl-en">webpack.DefinePlugin</span>({
          <span class="pl-s"><span class="pl-pds">'</span>process.env<span class="pl-pds">'</span></span><span class="pl-k">:</span> {
              <span class="pl-s"><span class="pl-pds">'</span>NODE_ENV<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-c1">JSON</span>.<span class="pl-c1">stringify</span>(<span class="pl-s"><span class="pl-pds">'</span>production<span class="pl-pds">'</span></span>)
           }
       })
  ]
}</pre></div>
<p><code>npm run build</code>后发现<code>vendor.[hash].js</code>又变小了。</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/ee7c18ab0dd27e2bab82f5875309cd23ad44dba6/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f70726f647563742e706e67"><img src="https://camo.githubusercontent.com/ee7c18ab0dd27e2bab82f5875309cd23ad44dba6/687474703a2f2f6f71636238646a6c772e626b742e636c6f7564646e2e636f6d2f70726f647563742e706e67" alt="uglify" data-canonical-src="http://oqcb8djlw.bkt.clouddn.com/product.png" style="max-width:100%;"></a></p>
<h1><div id="op-cache">优化缓存</div></h1>
<p>刚才我们把<code>[name].[hash].js</code>变成<code>[name].[chunkhash].js</code>后，<code>npm run build</code>后，<br>
发现<code>app.xxx.js</code>和<code>vendor.xxx.js</code>不一样了哦。</p>
<p>但是现在又有一个问题了。</p>
<p>你随便修改代码一处，例如<code>Home.js</code>，随便改变个字，你发现<code>home.xxx.js</code>名字变化的同时，<br>
<code>vendor.xxx.js</code>名字也变了。这不行啊。这和没拆分不是一样一样了吗？我们本意是<code>vendor.xxx.js</code><br>
名字永久不变，一直缓存在用户本地的。~</p>
<p><a href="https://doc.webpack-china.org/guides/caching" rel="nofollow">官方文档</a>推荐了一个插件<a href="https://doc.webpack-china.org/plugins/hashed-module-ids-plugin" rel="nofollow">HashedModuleIdsPlugin</a></p>
<div class="bottom"><pre>    plugins<span class="pl-k">:</span> [
        <span class="pl-k">new</span> <span class="pl-en">webpack.HashedModuleIdsPlugin</span>()
    ]</pre></div>
<p>现在你打包，修改代码再试试，是不是名字不变啦？错了，现在打包，我发现名字还是变了，经过比对文档，我发现还要加一个<code>runtime</code>代码抽取，</p>
<div class="bottom"><pre><span class="pl-k">new</span> <span class="pl-en">webpack.optimize.CommonsChunkPlugin</span>({
    name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>runtime<span class="pl-pds">'</span></span>
})</pre></div>
<p>加上这句话就好了~为什么呢？看下<a href="https://doc.webpack-china.org/concepts/manifest" rel="nofollow">解释</a>。</p>
<p><strong>注意，引入顺序在这里很重要。CommonsChunkPlugin 的 'vendor' 实例，必须在 'runtime' 实例之前引入。</strong></p>
<h1><div id="publicpath">public path</div></h1>
<p>想象一个场景，我们的静态文件放在了单独的静态服务器上去了，那我们打包的时候，如何让静态文件的链接定位到静态服务器呢？</p>
<p>看文档<a href="https://doc.webpack-china.org/guides/public-path" rel="nofollow">Public Path</a></p>
<p><code>webpack.config.js</code> <code>output</code> 中增加一个<code>publicPath</code>，我们当前用<code>/</code>，相对于当前路径，如果你要改成别的<code>url</code>，就改这里就好了。</p>
<div class="bottom"><pre>    output<span class="pl-k">:</span> {
        publicPath <span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>
    }</pre></div>
<h1><div id="op-build">打包优化</div></h1>
<p>你现在打开<code>dist</code>，是不是发现好多好多文件，每次打包后的文件在这里混合了？我们希望每次打包前自动清理下<code>dist</code>文件。</p>
<p><code>npm install clean-webpack-plugin --save-dev</code></p>
<p><code>webpack.config.js</code></p>
<div class="bottom"><pre><span class="pl-k">const</span> <span class="pl-c1">CleanWebpackPlugin</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>clean-webpack-plugin<span class="pl-pds">'</span></span>);


plugins<span class="pl-k">:</span> [
    <span class="pl-k">new</span> <span class="pl-en">CleanWebpackPlugin</span>([<span class="pl-s"><span class="pl-pds">'</span>dist<span class="pl-pds">'</span></span>])
]</pre></div>
<p>现在<code>npm run build</code>试试，是不是之前的都清空了。当然我们之前的<code>api</code>文件夹也被清空了，不过没关系哦~本来就是测试用的。</p>
<h1><div id="extract-text">抽取css</div></h1>
<p>目前我们的<code>css</code>是直接打包进<code>js</code>里面的，我们希望能单独生成<code>css</code>文件。</p>
<p>我们使用<a href="https://github.com/webpack-contrib/extract-text-webpack-plugin">extract-text-webpack-plugin</a>来实现。</p>
<p><code>npm install --save-dev extract-text-webpack-plugin</code></p>
<p><code>webpack.config.js</code></p>
<div class="bottom"><pre><span class="pl-k">const</span> <span class="pl-c1">ExtractTextPlugin</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">"</span>extract-text-webpack-plugin<span class="pl-pds">"</span></span>);

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> {
  module<span class="pl-k">:</span> {
    rules<span class="pl-k">:</span> [
      {
        test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>css<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
        use<span class="pl-k">:</span> <span class="pl-smi">ExtractTextPlugin</span>.<span class="pl-en">extract</span>({
          fallback<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>style-loader<span class="pl-pds">"</span></span>,
          use<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>css-loader<span class="pl-pds">"</span></span>
        })
      }
    ]
  },
  plugins<span class="pl-k">:</span> [
     <span class="pl-k">new</span> <span class="pl-en">ExtractTextPlugin</span>({
         filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].[contenthash:5].css<span class="pl-pds">'</span></span>,
         allChunks<span class="pl-k">:</span> <span class="pl-c1">true</span>
     })
  ]
}</pre></div>
<p><code>npm run build</code>后发现单独生成了<code>css</code>文件哦</p>
<h1><div id="op-http">使用<code>axios</code>和<code>middleware</code>优化API请求</div></h1>
<p>先安装下<a href="https://github.com/mzabriskie/axios">axios</a></p>
<p><code>npm install --save axios</code></p>
<p>我们之前项目的一次API请求是这样写的哦~</p>
<p><code>action</code>创建函数是这样的。比我们现在写的<code>fetch</code>简单多了。</p>
<div class="bottom"><pre><span class="pl-k">export</span> <span class="pl-k">function</span> <span class="pl-en">getUserInfo</span>() {
    <span class="pl-k">return</span> {
        types<span class="pl-k">:</span> [<span class="pl-c1">GET_USER_INFO_REQUEST</span>, <span class="pl-c1">GET_USER_INFO_SUCCESS</span>, <span class="pl-c1">GET_USER_INFO_FAIL</span>],
        <span class="pl-en">promise</span><span class="pl-k">:</span> <span class="pl-smi">client</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">client</span>.<span class="pl-c1">get</span>(<span class="pl-s"><span class="pl-pds">`</span>http://localhost:8080/api/user.json<span class="pl-pds">`</span></span>)
        <span class="pl-en">afterSuccess</span><span class="pl-k">:</span>(<span class="pl-smi">dispatch</span>,<span class="pl-smi">getState</span>,<span class="pl-smi">response</span>)<span class="pl-k">=&gt;</span>{
            <span class="pl-c"><span class="pl-c">/*</span>请求成功后执行的函数<span class="pl-c">*/</span></span>
        },
        otherData<span class="pl-k">:</span>otherData
    }
}</pre></div>
<p>然后在dispatch(getUserInfo())后，通过<code>redux</code>中间件来处理请求逻辑。</p>
<p>中间件的教程看<a href="http://cn.redux.js.org/docs/advanced/Middleware.html" rel="nofollow">这里</a></p>
<p>我们想想中间件的逻辑</p>
<ol>
<li>请求前<code>dispatch</code> <code>REQUEST</code>请求。</li>
<li>成功后<code>dispatch</code> <code>SUCCESS</code>请求，如果定义了<code>afterSuccess()</code>函数，调用它。</li>
<li>失败后<code>dispatch</code> <code>FAIL</code>请求。</li>
</ol>
<p>来写一个</p>
<div class="bottom"><pre>cd src<span class="pl-k">/</span>redux
mkdir middleware
cd middleware
touch <span class="pl-smi">promiseMiddleware</span>.<span class="pl-smi">js</span></pre></div>
<p><code>src/redux/middleware/promiseMiddleware.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">axios</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>axios<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span>  <span class="pl-smi">store</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">next</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">action</span> <span class="pl-k">=&gt;</span> {
    <span class="pl-k">const</span> {<span class="pl-c1">dispatch</span>, <span class="pl-c1">getState</span>} <span class="pl-k">=</span> store;
    <span class="pl-c"><span class="pl-c">/*</span>如果dispatch来的是一个function，此处不做处理，直接进入下一级<span class="pl-c">*/</span></span>
    <span class="pl-k">if</span> (<span class="pl-k">typeof</span> action <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>function<span class="pl-pds">'</span></span>) {
        <span class="pl-en">action</span>(dispatch, getState);
        <span class="pl-k">return</span>;
    }
    <span class="pl-c"><span class="pl-c">/*</span>解析action<span class="pl-c">*/</span></span>
    <span class="pl-k">const</span> {
        <span class="pl-c1">promise</span>,
        <span class="pl-c1">types</span>,
        <span class="pl-c1">afterSuccess</span>,
        <span class="pl-k">...</span><span class="pl-c1">rest</span>
    } <span class="pl-k">=</span> action;

    <span class="pl-c"><span class="pl-c">/*</span>没有promise，证明不是想要发送ajax请求的，就直接进入下一步啦！<span class="pl-c">*/</span></span>
    <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">action</span>.<span class="pl-smi">promise</span>) {
        <span class="pl-k">return</span> <span class="pl-en">next</span>(action);
    }

    <span class="pl-c"><span class="pl-c">/*</span>解析types<span class="pl-c">*/</span></span>
    <span class="pl-k">const</span> [<span class="pl-c1">REQUEST</span>,
        <span class="pl-c1">SUCCESS</span>,
        <span class="pl-c1">FAILURE</span>] <span class="pl-k">=</span> types;

    <span class="pl-c"><span class="pl-c">/*</span>开始请求的时候，发一个action<span class="pl-c">*/</span></span>
    <span class="pl-en">next</span>({
        <span class="pl-k">...</span>rest,
        type<span class="pl-k">:</span> <span class="pl-c1">REQUEST</span>
    });
    <span class="pl-c"><span class="pl-c">/*</span>定义请求成功时的方法<span class="pl-c">*/</span></span>
    <span class="pl-k">const</span> <span class="pl-c1">onFulfilled</span> <span class="pl-k">=</span> <span class="pl-smi">result</span> <span class="pl-k">=&gt;</span> {
        <span class="pl-en">next</span>({
            <span class="pl-k">...</span>rest,
            result,
            type<span class="pl-k">:</span> <span class="pl-c1">SUCCESS</span>
        });
        <span class="pl-k">if</span> (afterSuccess) {
            <span class="pl-en">afterSuccess</span>(dispatch, getState, result);
        }
    };
    <span class="pl-c"><span class="pl-c">/*</span>定义请求失败时的方法<span class="pl-c">*/</span></span>
    <span class="pl-k">const</span> <span class="pl-c1">onRejected</span> <span class="pl-k">=</span> <span class="pl-smi">error</span> <span class="pl-k">=&gt;</span> {
        <span class="pl-en">next</span>({
            <span class="pl-k">...</span>rest,
            error,
            type<span class="pl-k">:</span> <span class="pl-c1">FAILURE</span>
        });
    };

    <span class="pl-k">return</span> <span class="pl-en">promise</span>(axios).<span class="pl-c1">then</span>(onFulfilled, onRejected).<span class="pl-c1">catch</span>(<span class="pl-smi">error</span> <span class="pl-k">=&gt;</span> {
        <span class="pl-en">console</span>.<span class="pl-c1">error</span>(<span class="pl-s"><span class="pl-pds">'</span>MIDDLEWARE ERROR:<span class="pl-pds">'</span></span>, error);
        <span class="pl-en">onRejected</span>(error)
    })
}
</pre></div>
<p>修改<code>src/redux/store.js</code>来应用这个中间件</p>
<div class="bottom"><pre><span class="pl-k">import</span> {<span class="pl-smi">createStore</span>, <span class="pl-smi">applyMiddleware</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>redux<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">combineReducers</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./reducers.js<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">promiseMiddleware</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./middleware/promiseMiddleware<span class="pl-pds">'</span></span>

<span class="pl-k">let</span> store <span class="pl-k">=</span> <span class="pl-en">createStore</span>(combineReducers, <span class="pl-en">applyMiddleware</span>(promiseMiddleware));

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">store</span>;</pre></div>
<p>修改<code>src/redux/actions/userInfo.js</code></p>
<div class="bottom"><pre><span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-c1">GET_USER_INFO_REQUEST</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>userInfo/GET_USER_INFO_REQUEST<span class="pl-pds">"</span></span>;
<span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-c1">GET_USER_INFO_SUCCESS</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>userInfo/GET_USER_INFO_SUCCESS<span class="pl-pds">"</span></span>;
<span class="pl-k">export</span> <span class="pl-k">const</span> <span class="pl-c1">GET_USER_INFO_FAIL</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>userInfo/GET_USER_INFO_FAIL<span class="pl-pds">"</span></span>;

<span class="pl-k">export</span> <span class="pl-k">function</span> <span class="pl-en">getUserInfo</span>() {
    <span class="pl-k">return</span> {
        types<span class="pl-k">:</span> [<span class="pl-c1">GET_USER_INFO_REQUEST</span>, <span class="pl-c1">GET_USER_INFO_SUCCESS</span>, <span class="pl-c1">GET_USER_INFO_FAIL</span>],
        <span class="pl-en">promise</span><span class="pl-k">:</span> <span class="pl-smi">client</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">client</span>.<span class="pl-c1">get</span>(<span class="pl-s"><span class="pl-pds">`</span>http://localhost:8080/api/user.json<span class="pl-pds">`</span></span>)
    }
}</pre></div>
<p>是不是简单清新很多啦？</p>
<p>修改<code>src/redux/reducers/userInfo.js</code></p>
<div class="bottom"><pre>        case <span class="pl-c1">GET_USER_INFO_SUCCESS</span><span class="pl-k">:</span>
            <span class="pl-k">return</span> {
                <span class="pl-k">...</span>state,
                isLoading<span class="pl-k">:</span> <span class="pl-c1">false</span>,
                userInfo<span class="pl-k">:</span> <span class="pl-smi">action</span>.<span class="pl-smi">result</span>.<span class="pl-c1">data</span>,
                errorMsg<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>
            };</pre></div>
<p><code>action.userInfo</code>修改成了<code>action.result.data</code>。你看中间件，请求成功，会给<code>action</code>增加一个<code>result</code>字段来存储响应结果哦~不用手动传了。</p>
<p><code>npm start</code>看看我们的网络请求是不是正常哦。</p>
<h1><div id="editor">调整文本编辑器</div></h1>
<p>使用自动编译代码时，可能会在保存文件时遇到一些问题。某些编辑器具有“安全写入”功能，可能会影响重新编译。</p>
<p>要在一些常见的编辑器中禁用此功能，请查看以下列表：</p>
<ul>
<li>Sublime Text 3 - 在用户首选项(user preferences)中添加 atomic_save: "false"。</li>
<li>IntelliJ - 在首选项(preferences)中使用搜索，查找到 "safe write" 并且禁用它。</li>
<li>Vim - 在设置(settings)中增加 :set backupcopy=yes。</li>
<li>WebStorm - 在 Preferences &gt; Appearance &amp; Behavior &gt; System Settings 中取消选中 Use "safe write"。</li>
</ul>
<h1><div id="webpack-common-config">合并提取<code>webpack</code>公共配置</div></h1>
<p>想象一个场景，现在我想给<code>webpack</code>增加一个<code>css modules</code>依赖，你会发现，WTF?我即要修改<code>webpack.dev.config.js</code>，又要修改<code>webpack.config.js</code>~</p>
<p>这肯定不行啊。所以我们要把公共的配置文件提取出来。提取到<code>webpack.common.config.js</code>里面~</p>
<p><code>webpack.dev.config.js</code>和<code>webpack.config.js</code>写自己的特殊的配置。</p>
<p>这里我们需要用到<a href="https://github.com/survivejs/webpack-merge">webpack-merge</a>来合并公共配置和单独的配置。</p>
<p>这样说一下，应该看代码就能看懂了。下次公共配置直接就写在<code>webpack.common.config.js</code>里面啦。</p>
<blockquote>
<p>这里偷偷说下，我修改了<code>CleanWebpackPlugin</code>的参数，不让他每次构建都删除<code>api</code>文件夹了。要不每次都得复制进去。麻烦~</p>
</blockquote>
<p><code>npm install --save-dev webpack-merge</code></p>
<p><code>touch webpack.common.config.js</code></p>
<p><code>webpack.common.config.js</code></p>
<div class="bottom"><pre><span class="pl-k">const</span> <span class="pl-c1">path</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">HtmlWebpackPlugin</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>html-webpack-plugin<span class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">webpack</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack<span class="pl-pds">'</span></span>);

commonConfig <span class="pl-k">=</span> {
    entry<span class="pl-k">:</span> {
        app<span class="pl-k">:</span> [
            <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/index.js<span class="pl-pds">'</span></span>)
        ],
        vendor<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>react-router-dom<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>redux<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>react-dom<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>react-redux<span class="pl-pds">'</span></span>]
    },
    output<span class="pl-k">:</span> {
        path<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>./dist<span class="pl-pds">'</span></span>),
        filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].[chunkhash].js<span class="pl-pds">'</span></span>,
        chunkFilename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].[chunkhash].js<span class="pl-pds">'</span></span>,
        publicPath<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>
    },
    module<span class="pl-k">:</span> {
        rules<span class="pl-k">:</span> [{
            test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>js<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
            use<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>babel-loader?cacheDirectory=true<span class="pl-pds">'</span></span>],
            include<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src<span class="pl-pds">'</span></span>)
        }, {
            test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>(png<span class="pl-k">|</span>jpg<span class="pl-k">|</span>gif)<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
            use<span class="pl-k">:</span> [{
                loader<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>url-loader<span class="pl-pds">'</span></span>,
                options<span class="pl-k">:</span> {
                    limit<span class="pl-k">:</span> <span class="pl-c1">8192</span>
                }
            }]
        }]
    },
    plugins<span class="pl-k">:</span> [
        <span class="pl-k">new</span> <span class="pl-en">HtmlWebpackPlugin</span>({
            filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>index.html<span class="pl-pds">'</span></span>,
            template<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/index.html<span class="pl-pds">'</span></span>)
        }),
        <span class="pl-k">new</span> <span class="pl-en">webpack.HashedModuleIdsPlugin</span>(),
        <span class="pl-k">new</span> <span class="pl-en">webpack.optimize.CommonsChunkPlugin</span>({
            name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>vendor<span class="pl-pds">'</span></span>
        }),
        <span class="pl-k">new</span> <span class="pl-en">webpack.optimize.CommonsChunkPlugin</span>({
            name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>runtime<span class="pl-pds">'</span></span>
        })
    ],

    resolve<span class="pl-k">:</span> {
        alias<span class="pl-k">:</span> {
            pages<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/pages<span class="pl-pds">'</span></span>),
            components<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/components<span class="pl-pds">'</span></span>),
            router<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/router<span class="pl-pds">'</span></span>),
            actions<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/redux/actions<span class="pl-pds">'</span></span>),
            reducers<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/redux/reducers<span class="pl-pds">'</span></span>)
        }
    }
};

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> commonConfig;</pre></div>
<p><code>webpack.dev.config.js</code></p>
<div class="bottom"><pre><span class="pl-k">const</span> <span class="pl-c1">merge</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack-merge<span class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">path</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">commonConfig</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./webpack.common.config.js<span class="pl-pds">'</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">devConfig</span> <span class="pl-k">=</span> {
    devtool<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>inline-source-map<span class="pl-pds">'</span></span>,
    entry<span class="pl-k">:</span> {
        app<span class="pl-k">:</span> [
            <span class="pl-s"><span class="pl-pds">'</span>react-hot-loader/patch<span class="pl-pds">'</span></span>,
            <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/index.js<span class="pl-pds">'</span></span>)
        ]
    },
    output<span class="pl-k">:</span> {
        <span class="pl-c"><span class="pl-c">/*</span>这里本来应该是[chunkhash]的，但是由于[chunkhash]和react-hot-loader不兼容。只能妥协<span class="pl-c">*/</span></span>
        filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].[hash].js<span class="pl-pds">'</span></span>
    },
    module<span class="pl-k">:</span> {
        rules<span class="pl-k">:</span> [{
            test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>css<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
            use<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">"</span>style-loader<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>css-loader<span class="pl-pds">"</span></span>]
        }]
    },
    devServer<span class="pl-k">:</span> {
        contentBase<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>./dist<span class="pl-pds">'</span></span>),
        historyApiFallback<span class="pl-k">:</span> <span class="pl-c1">true</span>,
        host<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>0.0.0.0<span class="pl-pds">'</span></span>,
    }
};

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> <span class="pl-en">merge</span>({
    <span class="pl-en">customizeArray</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>, <span class="pl-smi">key</span>) {
        <span class="pl-c"><span class="pl-c">/*</span>entry.app不合并，全替换<span class="pl-c">*/</span></span>
        <span class="pl-k">if</span> (key <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>entry.app<span class="pl-pds">'</span></span>) {
            <span class="pl-k">return</span> b;
        }
        <span class="pl-k">return</span> <span class="pl-c1">undefined</span>;
    }
})(commonConfig, devConfig);</pre></div>
<p><code>webpack.config.js</code></p>
<div class="bottom"><pre><span class="pl-k">const</span> <span class="pl-c1">merge</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack-merge<span class="pl-pds">'</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">webpack</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack<span class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">UglifyJSPlugin</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>uglifyjs-webpack-plugin<span class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">CleanWebpackPlugin</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>clean-webpack-plugin<span class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">ExtractTextPlugin</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">"</span>extract-text-webpack-plugin<span class="pl-pds">"</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">commonConfig</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./webpack.common.config.js<span class="pl-pds">'</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">publicConfig</span> <span class="pl-k">=</span> {
    devtool<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>cheap-module-source-map<span class="pl-pds">'</span></span>,
    module<span class="pl-k">:</span> {
        rules<span class="pl-k">:</span> [{
            test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>css<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
            use<span class="pl-k">:</span> <span class="pl-smi">ExtractTextPlugin</span>.<span class="pl-en">extract</span>({
                fallback<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>style-loader<span class="pl-pds">"</span></span>,
                use<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>css-loader<span class="pl-pds">"</span></span>
            })
        }]
    },
    plugins<span class="pl-k">:</span> [
        <span class="pl-k">new</span> <span class="pl-en">CleanWebpackPlugin</span>([<span class="pl-s"><span class="pl-pds">'</span>dist/*.*<span class="pl-pds">'</span></span>]),
        <span class="pl-k">new</span> <span class="pl-en">UglifyJSPlugin</span>(),
        <span class="pl-k">new</span> <span class="pl-en">webpack.DefinePlugin</span>({
            <span class="pl-s"><span class="pl-pds">'</span>process.env<span class="pl-pds">'</span></span><span class="pl-k">:</span> {
                <span class="pl-s"><span class="pl-pds">'</span>NODE_ENV<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-c1">JSON</span>.<span class="pl-c1">stringify</span>(<span class="pl-s"><span class="pl-pds">'</span>production<span class="pl-pds">'</span></span>)
            }
        }),
        <span class="pl-k">new</span> <span class="pl-en">ExtractTextPlugin</span>({
            filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].[contenthash:5].css<span class="pl-pds">'</span></span>,
            allChunks<span class="pl-k">:</span> <span class="pl-c1">true</span>
        })
    ]

};

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> <span class="pl-en">merge</span>(commonConfig, publicConfig);</pre></div>
<h1><div id="op-dir-404">优化目录结构并增加404页面</div></h1>
<p>现在我们优化下目录结构，把<code>router</code>和<code>nav</code>分开，新建根组件<code>App</code>。</p>
<ol>
<li><code>component</code>改名为<code>components</code>,因为是复数。。。注意修改引用的地方哦。</li>
<li>新建根组件<code>components/App/APP.js</code></li>
</ol>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">Nav</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>components/Nav/Nav<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">getRouter</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>router/router<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">class</span> <span class="pl-en">App</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {
    <span class="pl-en">render</span>() {
        <span class="pl-k">return</span> (
            <span class="pl-k">&lt;</span>div<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Nav<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                {<span class="pl-en">getRouter</span>()}
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        )
    }
}</pre></div>
<ol>
<li>新建<code>components/Nav/Nav</code>组件，把<code>router/router.js</code>里面的<code>nav</code>提出来。</li>
<li>新建<code>components/Loading/Loading</code>组件,把<code>router/router.js</code>里面的<code>Loading</code>提出来。</li>
<li>入口文件<code>src/index.js</code>修改</li>
</ol>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">ReactDom</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-dom<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> {<span class="pl-smi">AppContainer</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-hot-loader<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> {<span class="pl-smi">Provider</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-redux<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">store</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./redux/store<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> {<span class="pl-smi">BrowserRouter</span> <span class="pl-k">as</span> <span class="pl-smi">Router</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-router-dom<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-smi">App</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>components/App/App<span class="pl-pds">'</span></span>;

<span class="pl-en">renderWithHotReload</span>(App);

<span class="pl-k">if</span> (<span class="pl-c1">module</span>.<span class="pl-smi">hot</span>) {
    <span class="pl-c1">module</span>.<span class="pl-smi">hot</span>.<span class="pl-c1">accept</span>(<span class="pl-s"><span class="pl-pds">'</span>components/App/App<span class="pl-pds">'</span></span>, () <span class="pl-k">=&gt;</span> {
        <span class="pl-k">const</span> <span class="pl-c1">NextApp</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>components/App/App<span class="pl-pds">'</span></span>).<span class="pl-smi">default</span>;
        <span class="pl-en">renderWithHotReload</span>(NextApp);
    });
}

<span class="pl-k">function</span> <span class="pl-en">renderWithHotReload</span>(<span class="pl-smi">RootElement</span>) {
    <span class="pl-smi">ReactDom</span>.<span class="pl-en">render</span>(
        <span class="pl-k">&lt;</span>AppContainer<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>Provider store<span class="pl-k">=</span>{store}<span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span>Router<span class="pl-k">&gt;</span>
                    <span class="pl-k">&lt;</span>RootElement<span class="pl-k">/</span><span class="pl-k">&gt;</span>
                <span class="pl-k">&lt;</span><span class="pl-k">/</span>Router<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>Provider<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span><span class="pl-k">/</span>AppContainer<span class="pl-k">&gt;</span>,
        <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>app<span class="pl-pds">'</span></span>)
    )
}
</pre></div>
<ol>
<li>新建<code>pages/NotFound/NotFound</code>组件。</li>
<li>修改<code>router/router.js</code>，增加<code>404</code></li>
</ol>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">NotFound</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>bundle-loader?lazy&amp;name=notFound!pages/NotFound/NotFound<span class="pl-pds">'</span></span>;

<span class="pl-k">&lt;</span>Route component<span class="pl-k">=</span>{<span class="pl-en">createComponent</span>(NotFound)}<span class="pl-k">/</span><span class="pl-k">&gt;</span></pre></div>
<h1><div id="babel-polyfill">加入 babel-plugin-transform-runtime 和 babel-polyfill</div></h1>
<ol>
<li>
<p>先来说说<a href="https://github.com/babel/babel/tree/master/packages/babel-plugin-transform-runtime">babel-plugin-transform-runtime</a></p>
<blockquote>
<p>在转换 ES2015 语法为 ECMAScript 5 的语法时，babel 会需要一些辅助函数，例如 _extend。babel 默认会将这些辅助函数内联到每一个 js 文件里，这样文件多的时候，项目就会很大。</p>
</blockquote>
<blockquote>
<p>所以 babel 提供了 transform-runtime 来将这些辅助函数“搬”到一个单独的模块 babel-runtime 中，这样做能减小项目文件的大小。</p>
</blockquote>
<p><code>npm install --save-dev babel-plugin-transform-runtime</code></p>
</li>
</ol>
<pre><code>修改`.babelrc`配置文件,增加配置

.babelrc

​```javascript
     "plugins": [
       "transform-runtime"
     ]
​```

</code></pre>
<ol>
<li>
<p>再来看<a href="https://babeljs.io/docs/usage/polyfill/" rel="nofollow">babel-polyfill</a></p>
<p>Q: 为什么要集成<code>babel-polyfill</code>?</p>
<p>A:</p>
<blockquote>
<p>Babel默认只转换新的JavaScript句法（syntax），而不转换新的API，比如Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise等全局对象，以及一些定义在全局对象上的方法（比如Object.assign）都不会转码。<br>
举例来说，ES6在Array对象上新增了Array.from方法。Babel就不会转码这个方法。如果想让这个方法运行，必须使用babel-polyfill，为当前环境提供一个垫片。</p>
</blockquote>
<p>网上很多人说，集成了<code>transform-runtime</code>就不用<code>babel-polyfill</code>了，其实不然，看看官方怎么说的：</p>
<blockquote>
<p>NOTE: Instance methods such as "foobar".includes("foo") will not work since that would require modification of existing built-ins (Use babel-polyfill for that).</p>
</blockquote>
<p>所以，我们还是需要<code>babel-polyfill</code>哦。</p>
<p><code>npm install --save-dev babel-polyfill</code></p>
<p>修改webpack两个配置文件。</p>
<p><code>webpack.common.config.js</code></p>
<div class="bottom"><pre>     app<span class="pl-k">:</span> [
         <span class="pl-s"><span class="pl-pds">"</span>babel-polyfill<span class="pl-pds">"</span></span>,
         <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/index.js<span class="pl-pds">'</span></span>)
     ]</pre></div>
<p><code>webpack.dev.config.js</code></p>
<div class="bottom"><pre>     app<span class="pl-k">:</span> [
         <span class="pl-s"><span class="pl-pds">'</span>babel-polyfill<span class="pl-pds">'</span></span>,
         <span class="pl-s"><span class="pl-pds">'</span>react-hot-loader/patch<span class="pl-pds">'</span></span>,
         <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src/index.js<span class="pl-pds">'</span></span>)
     ]</pre></div>
</li>
</ol>
<p>参考地址：</p>
<ol>
<li><a href="http://www.ruanyifeng.com/blog/2016/01/babel.html" rel="nofollow">http://www.ruanyifeng.com/blog/2016/01/babel.html</a></li>
<li><a class="issue-link js-issue-link" data-error-text="Failed to load issue title" data-id="163787744" data-permission-text="Issue title is private" data-url="https://github.com/lmk123/blog/issues/45" data-hovercard-type="issue" data-hovercard-url="/lmk123/blog/issues/45/hovercard" href="https://github.com/lmk123/blog/issues/45">lmk123/blog#45</a></li>
<li><a href="https://github.com/thejameskyle/babel-handbook/blob/master/translations/zh-Hans/README.md">https://github.com/thejameskyle/babel-handbook/blob/master/translations/zh-Hans/README.md</a></li>
</ol>
<h1><div id="postcss">集成PostCSS</div></h1>
<p><a href="https://github.com/postcss/postcss">官方文档看这里</a></p>
<p>Q: 这是啥？为什么要用它？</p>
<p>他有很多很多的插件，我们举几个例子~</p>
<p><a href="https://github.com/postcss/autoprefixer">Autoprefixer</a>这个插件,可以自动给css属性加浏览器前缀。</p>
<div class="bottom"><pre><span class="pl-c"><span class="pl-c">/*</span>编译前<span class="pl-c">*/</span></span>
.<span class="pl-smi">container</span>{
    display<span class="pl-k">:</span> flex;
}
<span class="pl-c"><span class="pl-c">/*</span>编译后<span class="pl-c">*/</span></span>
.<span class="pl-smi">container</span>{
    display<span class="pl-k">:</span> <span class="pl-k">-</span>webkit<span class="pl-k">-</span>box;
    display<span class="pl-k">:</span> <span class="pl-k">-</span>webkit<span class="pl-k">-</span>flex;
    display<span class="pl-k">:</span> <span class="pl-k">-</span>ms<span class="pl-k">-</span>flexbox;
    display<span class="pl-k">:</span> flex;
}</pre></div>
<p><a href="http://cssnext.io/" rel="nofollow">postcss-cssnext</a> 允许你使用未来的 CSS 特性（包括 autoprefixer）</p>
<p>当然，它有很多很多的插件可以用，你可以去官网详细了解。我们今天只用<code>postcss-cssnext</code>。（它包含了autoprefixer）</p>
<div class="bottom"><pre>npm install <span class="pl-k">--</span>save<span class="pl-k">-</span>dev  postcss<span class="pl-k">-</span>loader
npm install <span class="pl-k">--</span>save<span class="pl-k">-</span>dev  postcss<span class="pl-k">-</span>cssnext</pre></div>
<p>修改<code>webpack</code>配置文件,增加<code>postcss-loader</code></p>
<p>webpack.dev.config.js</p>
<div class="bottom"><pre>        rules<span class="pl-k">:</span> [{
            test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>(css<span class="pl-k">|</span>scss)<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
            use<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">"</span>style-loader<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>css-loader<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>postcss-loader<span class="pl-pds">"</span></span>]
        }]</pre></div>
<p>webpack.config.js</p>
<div class="bottom"><pre>        rules<span class="pl-k">:</span> [{
            test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>css<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
            use<span class="pl-k">:</span> <span class="pl-smi">ExtractTextPlugin</span>.<span class="pl-en">extract</span>({
                fallback<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>style-loader<span class="pl-pds">"</span></span>,
                use<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">"</span>css-loader<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>postcss-loader<span class="pl-pds">"</span></span>]
            })
        }]</pre></div>
<p>根目录增加<code>postcss</code>配置文件。</p>
<div class="bottom"><pre>touch <span class="pl-smi">postcss</span>.<span class="pl-smi">config</span>.<span class="pl-smi">js</span></pre></div>
<p><code>postcss.config.js</code></p>
<div class="bottom"><pre><span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> {
    plugins<span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">'</span>postcss-cssnext<span class="pl-pds">'</span></span><span class="pl-k">:</span> {}
    }
};</pre></div>
<p>现在你运行代码，然后写个css，去浏览器审查元素，看看，属性是不是生成了浏览器前缀？</p>
<h1><div id="redux-hot">redux 模块热替换配置</div></h1>
<p>今天突然发现，当修改reducer代码的时候，页面会整个刷新，而不是局部刷新唉。</p>
<p>这不行，就去查了webpack文档，果然是要配置的。<a href="https://survivejs.com/webpack/appendices/hmr-with-react/#configuring-hmr-with-redux" rel="nofollow">看这里</a></p>
<p>代码修改起来也简单,增加一段监听reducers变化，并替换的代码。</p>
<p><code>src/redux/store.js</code></p>
<div class="bottom"><pre><span class="pl-k">if</span> (<span class="pl-c1">module</span>.<span class="pl-smi">hot</span>) {
    <span class="pl-c1">module</span>.<span class="pl-smi">hot</span>.<span class="pl-c1">accept</span>(<span class="pl-s"><span class="pl-pds">"</span>./reducers<span class="pl-pds">"</span></span>, () <span class="pl-k">=&gt;</span> {
        <span class="pl-k">const</span> <span class="pl-c1">nextCombineReducers</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">"</span>./reducers<span class="pl-pds">"</span></span>).<span class="pl-smi">default</span>;
        <span class="pl-smi">store</span>.<span class="pl-en">replaceReducer</span>(nextCombineReducers);
    });
}</pre></div>
<p>哦了~</p>
<h1><div id="mockjs">模拟AJAX数据之Mock.js</div></h1>
<p>每个改进都是为了解决问题。</p>
<p>现在我在开发中碰到了问题，我先描述下问题：</p>
<p>我们现在做前后端完全分离的应用，前端写前端的，后端写后端的，他们通过API接口连接。</p>
<p>前端同学心理路程："后端同学接口写的好慢，我都没法调试了。"</p>
<p>是不是有这个问题呢？一般我们怎么解决？</p>
<p>第一种：自己这边随便造点数据，等后端接口写好了之后，再小修改,再调试。</p>
<p>第二种：想想我们之前获得用户信息的<code>dist/api/user.json</code>，我们可以用这种方式来调试。<br>
但是想象下，我们要模拟一个文章列表，就要手动写几十列。oh~no!</p>
<p>并且，后端接口一般都不带<code>.json</code>，到时候对接，是不是还得改代码？</p>
<p>好了，下面介绍下今天的主角<a href="http://mockjs.com/" rel="nofollow">Mock.js</a>。</p>
<p>他会做一件事情：<strong>拦截AJAX请求，返回需要的数据！</strong></p>
<p>我们写AJAX请求的时候，正常写，Mock.js会自动拦截的。</p>
<p>Mock.js提供各种随机生成数据。具体可以去官网看~</p>
<p>下面我们就在项目中集成咯：</p>
<ol>
<li>
<p><code>npm install mockjs --save-dev</code></p>
</li>
<li>
<p>新建mock文件夹</p>
<p><code>touch mock</code></p>
</li>
<li>
<p>模拟一个我们之前用到的<code>/api/user</code>接口</p>
<pre><code> cd mock
 touch mock.js

</code></pre>
<p><code>mock/mock.js</code></p>
<pre lang="$xslt"><code> import Mock from 'mockjs';
 
 let Random = Mock.Random;
 
 Mock.mock('/api/user', {
     'name': '@cname',
     'intro': '@word(20)'
 });
</code></pre>
<p>上面代码的意思就是，拦截<code>/api/user</code>，返回随机的一个中文名字，一个20个字母的字符串。</p>
<p>我知道你看不懂，你去看看<a href="http://mockjs.com/" rel="nofollow">Mock.js</a>文档就能看懂啦！</p>
</li>
<li>
<p>与我们的项目连接。到目前为止，刚才定义的接口和我们的项目还没有关系。</p>
<p>先来做，在<code>src/index.js</code>里面增加一行代码：</p>
<p><code>src/index.js</code></p>
<pre><code>import '../mock/mock';

</code></pre>
</li>
<li>
<p>现在我们删除<code>dist/api</code>文件夹，然后修改之间的接口路径，把<code>.json</code>去掉。</p>
<p><code>rm -rf dist/api</code></p>
<p><code>src/redux/actions/userInfo.js</code></p>
<pre><code>/*promise: client =&gt; client.get(`/api/user.json`)*/

promise: client =&gt; client.get(`/api/user`)

</code></pre>
<p>现在我们运行<code>npm start</code>，到获取用户信息界面，看每次获取用户信息都会变化呀？</p>
</li>
</ol>
<p>到这里还没完，我们还要配置：只有在开发坏境下，才引入<code>mock</code>，在生产坏境，不引入。</p>
<p>跟着我做：</p>
<p>先给<code>mock</code>文件夹加个别名，这个我就不单独介绍了：</p>
<p><code>webpack.common.config.js</code></p>
<pre><code>    resolve: {
        alias: {
            ...
            mock: path.join(__dirname, 'mock')
        }
    }

</code></pre>
<p><code>webpack.dev.config.js</code>增加</p>
<pre><code>   const webpack = require('webpack');


   plugins:[
        new webpack.DefinePlugin({
               MOCK: true
        })
    ]

</code></pre>
<p>然后修改<code>src/index.js</code>刚才加的那句话为下面这样</p>
<pre><code>if (MOCK) {
    require('mock/mock');
}

</code></pre>
<p>这样，就只会在<code>npm start</code> 开发模式下，才会应用mock，如果你不想用，就把MOCK改成false就好了。</p>
<p>哦了，到这里就结束了~回头缕下：</p>
<p>我们定义了mock，在index.js引入。</p>
<p>mock的工作就是，拦截AJAX请求，返回模拟数据。</p>
<p>参考文章：</p>
<p><a rel="nofollow" href="http://www.jianshu.com/p/dd23a6547114">http://www.jianshu.com/p/dd23a6547114</a></p>
<p><a rel="nofollow" href="https://segmentfault.com/a/1190000005793320">https://segmentfault.com/a/1190000005793320</a></p>
<h1><div id="css-modules">使用 CSS Modules<div></div></div></h1>
<p>关于什么是<code>CSS Modules</code>，我这里不介绍。</p>
<p>可以去看阮一峰的文章<a href="http://www.ruanyifeng.com/blog/2016/06/css_modules.html" rel="nofollow">CSS Modules 用法教程</a></p>
<p>修改以下几个地方：</p>
<ol>
<li>
<p><code>webpack.dev.config.js</code></p>
<div class="bottom"><pre>module<span class="pl-k">:</span> {
        rules<span class="pl-k">:</span> [{
            test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>css<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
            use<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">"</span>style-loader<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>css-loader?modules&amp;localIdentName=[local]-[hash:base64:5]<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>postcss-loader<span class="pl-pds">"</span></span>]
        }]
    }</pre></div>
</li>
<li>
<p><code>webpack.config.js</code></p>
<div class="bottom"><pre>module<span class="pl-k">:</span> {
    rules<span class="pl-k">:</span> [{
        test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>css<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
        use<span class="pl-k">:</span> <span class="pl-smi">ExtractTextPlugin</span>.<span class="pl-en">extract</span>({
            fallback<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>style-loader<span class="pl-pds">"</span></span>,
            use<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">"</span>css-loader?modules&amp;localIdentName=[local]-[hash:base64:5]<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>postcss-loader<span class="pl-pds">"</span></span>]
        })
    }]
}</pre></div>
</li>
<li>
<p><code>src/pages/Page1/page1.css</code></p>
<div class="highlight highlight-source-css"><pre><span class="pl-e">.box</span> {
    <span class="pl-c1"><span class="pl-c1">border</span></span>: <span class="pl-c1">1<span class="pl-k">px</span></span> <span class="pl-c1">solid</span> <span class="pl-c1">red</span>;
}</pre></div>
</li>
<li>
<p><code>src/pages/Page1/Page1.js</code></p>
<div class="bottom"><pre><span class="pl-k">import</span> <span class="pl-smi">React</span>, {<span class="pl-smi">Component</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">style</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./Page1.css<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> <span class="pl-smi">image</span> <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./images/brickpsert.jpg<span class="pl-pds">'</span></span>;

<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-k">class</span> <span class="pl-en">Page1</span> <span class="pl-k">extends</span> <span class="pl-e">Component</span> {
    <span class="pl-en">render</span>() {
        <span class="pl-k">return</span> (
            <span class="pl-k">&lt;</span>div className<span class="pl-k">=</span>{<span class="pl-smi">style</span>.<span class="pl-smi">box</span>}<span class="pl-k">&gt;</span>
                <span class="pl-c1">this</span> is page1<span class="pl-k">~</span>
                <span class="pl-k">&lt;</span>img src<span class="pl-k">=</span>{image}<span class="pl-k">/</span><span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        )
    }
}</pre></div>
</li>
</ol>
<p>enjoy it!</p>
<h1><div id="json-server">使用 json-server 代替 Mock.js</div></h1>
<p><a href="https://github.com/typicode/json-server">json-server</a>和<code>Mock.js</code>一样，都是用来模拟接口数据的。</p>
<p><code>json-server</code>功能更强大，支持分页，排序，筛选等等，具体的可以去看<a href="https://github.com/typicode/json-server">文档</a>。</p>
<p>我们用<code>json-server</code>代替之前的<code>Mock.js</code>。</p>
<ol>
<li>
<p>删除<code>Mock.js</code>相关代码。</p>
<p>一共两处，<code>webpack.dev.config.js</code>,<code>src/index.js</code></p>
</li>
<li>
<p><code>npm install --save-dev json-server</code></p>
</li>
<li>
<p>写个demo，我们生成虚假数据还是用<code>mockjs</code>。</p>
</li>
</ol>
<p><code>mock/mock.js</code></p>
<div class="bottom"><pre><span class="pl-k">let</span> Mock <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>mockjs<span class="pl-pds">'</span></span>);

<span class="pl-k">var</span> Random <span class="pl-k">=</span> <span class="pl-smi">Mock</span>.<span class="pl-smi">Random</span>;

<span class="pl-c1">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () {
    <span class="pl-k">var</span> data <span class="pl-k">=</span> {};
    <span class="pl-smi">data</span>.<span class="pl-smi">user</span> <span class="pl-k">=</span> {
        <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-smi">Random</span>.<span class="pl-en">cname</span>(),
        <span class="pl-s"><span class="pl-pds">'</span>intro<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-smi">Random</span>.<span class="pl-en">word</span>(<span class="pl-c1">20</span>)
    };
    <span class="pl-k">return</span> data;
};</pre></div>
<ol>
<li>设置启动脚本</li>
</ol>
<p><code>package.json</code></p>
<pre><code>"mock": "json-server mock/mock.js --watch --port 8090",
"mockdev": "npm run mock &amp; npm start"

</code></pre>
<ol>
<li>webpack.dev.config.js 增加个代理，把我们的API请求，代理到<code>json-server</code>服务器去。</li>
</ol>
<div class="bottom"><pre>   devServer<span class="pl-k">:</span> {
        <span class="pl-k">...</span>
        proxy<span class="pl-k">:</span> {
                    <span class="pl-s"><span class="pl-pds">"</span>/api/*<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>http://localhost:8090/$1<span class="pl-pds">"</span></span>
                }
    }</pre></div>
<p>哦了，你可以<code>npm run mockdev</code>启动项目，然后访问我们之前的用户信息接口，试试啦。</p>
<p><strong>问题：<code>windows</code>不支持命令并行执行<code>&amp;</code>，你可以分开执行，或者使用<a href="https://www.npmjs.com/package/npm-run-all" rel="nofollow">npm-run-all</a></strong></p>
<h1><div id="question">问题修复<div></div></div></h1>
<h2>1. react热模块加载无效</h2>
<p>举例：在首页中，当我们计数加上去，然后修改代码，计数又恢复成0了。也就是热模块加载的时候，重置了<code>react</code>的<code>state</code>。</p>
<p>如果我们不使用<code>code splitting</code>，是没有这个问题的。但是我们就是要用，哼！</p>
<p>解决问题参考这里：<a href="https://github.com/gaearon/react-hot-loader/tree/next#code-splitting">https://github.com/gaearon/react-hot-loader/tree/next#code-splitting</a></p>
<p>解决步骤：</p>
<ol>
<li><code>npm install react-hot-loader@next</code></li>
<li>首页举例子</li>
</ol>
<div class="bottom"><pre><span class="pl-k">import</span> {<span class="pl-smi">hot</span>} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>react-hot-loader<span class="pl-pds">'</span></span>;
<span class="pl-k">...</span>
<span class="pl-k">export</span> <span class="pl-c1">default</span> <span class="pl-smi">hot</span>(<span class="pl-c1">module</span>)(Home);</pre></div>
<p>其他模块如果需要，可以自己同理修改哦。</p>
    </div>
</body>
</html>

