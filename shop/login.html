<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="images/logo.ico" type="image/x-icon"/>
    <title>快乐购商城 - 立即登录</title>
    <style>
        /**********************初始化样式*************************/
        body,html{width: 100%;}
        body,html,ul,ol,dl,dd,h1,h2,h3,h4,h5,h6,p,table,tr,td,th,li{margin: 0;padding: 0;}
        body{font-family: "微软雅黑";font-size: 14px;color: #555;}
        li{list-style: none;}
        img{border:0;vertical-align: middle;}
        a{text-decoration:none;color:#666;}

        .header_top{width:1000px;height:70px;padding:25px 0;overflow: hidden;margin:0 auto;line-height:70px;}
        .header_top img{vertical-align:middle;}
        #header{width: 100%;overflow: hidden;}
        #content{width: 100%;overflow: hidden;}
        .content_tip{width:960px;overflow: hidden;margin: 0 auto;padding:30px;}
        .content_left{float:left;}
        .content_right{width: 300px;height:500px;float:right;padding:0 40px;position:relative;}
        #quick_login,#com_login{width: 300px;overflow: hidden}
        .input_div{font-size:12px;margin:0 0 15px;color:#ccc;height: 16px;}
        #com_login{display:none;}
        #com_login .forget{float: right;color:#999;}
        .content_right .hint{font-size:10px;margin-bottom:16px;opacity: 0}
        .usertel,.userpwd{width:290px;height:34px;}
        .telecode,.identcode{width: 160px;height: 34px;}
        .reglogin{width: 300px;height:30px;line-height:30px;margin-bottom:20px;}
        #regbtn{width: 300px;height:40px;background:#990033;text-align: center;line-height: 40px;color:#fff; font-size:16px;margin-bottom:16px;}
        .otherlogin{margin-top:16px;}
        .otherlogin img{ width: 50px; height: 50px;margin-right:10px;}
        .select{ width: 300px;height: 40px;line-height: 40px;}
        #setCode{display: inline-block;vertical-align: top;width:110px;height:38px;line-height:40px;background:#ececec;text-align: center;border:1px solid #ccc;margin-left:20px;}
        .content_aside{position:absolute;right:-20px;top:0;width: 31px;height: 177px;background: url(images/login_a1.png) no-repeat}
        .content_aside img{position: absolute;right: 31px;top:-50px;display: none}
        .content_aside:hover img{display:block}


        .footer_bottom {width: 100%;overflow: hidden; background-color: #fff;margin-top:60px; }
        .w1200{ width:1000px; margin: 0 auto; text-align:center;}
        .footer_hint { font-family: Arial; color: #666666; }
        .footer_bottom p{ padding-top: 10px; text-align: center; font-family: "宋体"; color: #7e7e7e; line-height:25px;font-size:10px;}
        .footer_bottom .footer_picture { padding: 30px 0 40px 0; }
        .promptbox{position:fixed;width:300px;height:100px;opacity:0.9;background:#a21f25;
            border-radius:10px;color:#fff;text-align: center;line-height:100px;display:none;
            z-index:9999;font-size:30px;left: 0;right: 0;bottom: 0;top: 0;margin: auto}
    </style>
</head>
<body>
<div id="header">
    <div class="header_top">
        <span><a href="index.html"><img  src="images/header1.jpg" alt=""></a></span>
        <span><img src="images/header2.jpg" alt=""></span>
    </div>
</div>
<div id="content">
    <div class="content_tip">
        <div class="content_left">
            <img src="images/register_a1.jpg" alt="">
        </div>
        <div class="content_right">
            <div class="content_aside">
                <!--<img src="images/login_a1.png" alt="">-->
                <img src="images/login_a2.png" alt="">
            </div>
            <div class="reglogin"><span><b>登录快乐购</b></span><span>还没有快乐购账号<a href="register.html">快速注册</a></span></div>
            <div class="select">
                <input class="quick" type="radio" name="login"   checked><span>快捷登录</span>
                <input class="common" type="radio" name="login"><span>普通密码登录</span>
            </div>

            <div id="quick_login">
                <input class="usertel" placeholder="请输入手机号码"><br/>
                <div class="hint1 input_div">请输入手机号码</div>
                <input class="telecode" placeholder="验证码"><button id="setCode">获取验证码</button><br/>
                <div class="hint2 input_div">您输入您的短信验证码</div>
            </div>

            <div id="com_login">
                <input class="usertel" placeholder="请输入手机号码/用户名"><br/>
                    <div class="hint3 input_div">请输入手机号码</div>
                <input class="userpwd" placeholder="请输入密码">
                <div class="hint4 input_div">请输入您的密码,您的密码可能为字母.数字或符号的组合</div>
                <input class="identcode" placeholder="验证码">
                    <span id="randomcode" style="color:blue"></span>
                    <span id="changecode" style="color:red">换一张</span>
                    <div class="hint5 input_div">请输入右侧验证码</div>
                <input type="checkbox" checked>
                <span>记住用户名</span>
                <span class="forget"><a href="javascript:;">忘记密码</a></span>
            </div>
            <a href="javascript:;"><div id="regbtn">立即登录</div></a>
            <span>您可以使用以下账号登录</span><br/>
            <div class="otherlogin">
                <a href=""><img src="images/login_qq.png" alt=""></a>
                <a href=""><img src="images/login_wb.png" alt=""></a>
                <a href=""><img src="images/login_zfb.png" alt=""></a>
            </div>
        </div>
    </div>
</div>
<div class="footer_bottom">
    <div class="w1200">
        <p>
            <span class="footer_hint">Copyright© 2006-2016 happigo. All Rights Reserved </span>
            免费服务热线: 400-705-1111 | 固话也可拨打: 400-705-8800
            <span class="footer_hint">E-Mail: service@happigo.com</span><br />
            湘ICP备17009657号 信息网络传播视听节目许可证号：1810530
        </p>
        <p class="footer_picture">
            <img src="images/register_a2.png" />
            <img src="images/register_a3.png" />
        </p>
    </div>
</div>
<div class="promptbox"></div>
</body>
<script src="js/cookie.js"></script>
<script src="js/jquery.js"></script>
<script>
    $("#header span").eq(0).css({"float":"left"});
    $("#header span").eq(1).css({"float":"right"});
    $(".content_right span").eq(0).css({"float":"left"});
    $(".content_right span").eq(1).css({"float":"right"});
    $(".reglogin span").eq(0).css({"font-size":"24px","color":"#9A0000"});
    $(".reglogin span a").css({"color":"#9A0000"});
    if($("input[class='quick']").is(':checked')){
        $("#quick_login").css({"display":"block"});
        $("#com_login").css({"display":"none"})
    }else {
        $("#quick_login").css({"display":"none"});
        $("#com_login").css({"display":"block"})
    }
    var loginindex=0;
    $(".select input").click(function () {
        var index=$(this).index()/2;
        loginindex=index;
        if(index==0){
            $("#quick_login").css({"display":"block"});
            $("#com_login").css({"display":"none"})
        }else {
            $("#quick_login").css({"display":"none"});
            $("#com_login").css({"display":"block"})
        }
    });

    //发送验证码
    var receiveCode;
    var telReg=/^1(3|5|6|7|8)[0-9]{9}$/;
    $("#setCode").click(function () {
        if(telReg.test($(".usertel").val())){
            var phone=$(".usertel").val();
            $.ajax({
                    type:"get",
                    url:"sendcode/sendcode_1.php",
                    data:{phone:phone},
                    dataType:"json"})
                    .then(function (result) {
                        if(result["code"]==1){
                            downtime();
                            $(".hint1").html("");
                            $(".promptbox").css({"display":"block"}).html("发送成功").delay(1000).hide(0);
                            receiveCode=result["node"];
                        }else{
                            $(".hint1").html("用户不存在").css({"color":"red"});
                            $(".promptbox").css({"display":"block"}).html("发送失败").delay(1000).hide(0);

                        }
                    });
        }else {
            $(".hint1").html("手机号不合法").css({"color":"red"});
        }
    });
    $("#randomcode").html(getCode());
    $("#changecode").click(function () {$("#randomcode").html(getCode()); });
     //登录
    var usercode,userid;
    $("#regbtn").click(function () {
        if(loginindex==0){//手机号码登录
            var phone=$(".usertel").val();
            var telcode=$(".telecode").val();
            $.ajax({
                type:"get",
                url:"sendcode/sendcode_2.php",
                data:{phone:phone,telcode:telcode},
                dataType:"json"})
              .then(function (result) {
                        if(result["code"]==1){
                            $(".hint1").html("");
                            usercode=1;
                            userid=result["userid"];
                            setCookie("loginUserId", userid, 7);
                            setCookie("loginUserName", phone, 7);
                            var url=getCookie("loginurl");
                            if(url){
                                var cookies = document.cookie;
                                window.open(url)
                            }
                            else{ window.location.href="index.html";}
                        }else if(result["code"]==3){
                            $(".hint1").html("用户名不存在").css({"color":"red"})
                        }else if(result["code"]==2){$(".hint2").html("短信验证码错误").css({"color":"red"})}

                    });
        }else if(loginindex==1) {//用户名密码登录
            var phone = $("#com_login .usertel").val();
            var userpwd = $(".userpwd").val();
            var code = $(".identcode").val();
            var code2 = $("#randomcode").html();

            $.ajax({
                    type: "get",
                    url: "php/userlogin.php",
                    data: {phone: phone, userpwd: userpwd},
                    dataType: "json"
                    })
                .then(function (result) {
                    if (result["code"] == 1) {
                        usercode = 1;
                        userid = result["userid"];
                        setCookie("loginUserId", userid, 7);
                        setCookie("loginUserName", phone, 7);
                        var url = getCookie("loginurl");
                        if (url) {
                            if (code == code2.toLowerCase()) {
                                var cookies = document.cookie;
                                window.open(url)
                            } else {$(".hint4").html("");
                                $(".hint3").html("");
                                $(".hint5").html("验证码错误").css({"color": "red"})  }
                        }else {
                            if (code == code2.toLowerCase()) {
                                window.location.href = "index.html";
                            } else {$(".hint4").html("");
                                $(".hint3").html("");
                                $(".hint5").html("验证码错误").css({"color": "red"})  }
                             }
                    } else if (result["code"] == 3) {
                        $(".hint3").html("用户名不存在").css({"color": "red"})
                    } else {
                        $(".hint4").html("密码错误").css({"color": "red"})
                    }
                });


        }
    });

    //倒计时
    function downtime() {
        $("#setCode").disabled = true;   //当点击后倒计时时候不能点击此按钮
        var time = 60;   //倒计时5秒
        var timer = setInterval(fn, 1000);    //设置定时器
        function fn() {
            time--;
            if (time >= 0) {
                $("#setCode").html(time + "s后重新发送");
            } else {
                $("#setCode").html("重新发送验证码");
                $("#setCode").disabled = false;
                clearTimeout(timer); //清除定时器
                time = 60;   //设置循环重新开始条件
            }
        }
    }

    //随机验证码
    function getCode(){
        var codelist=[];
        for(var i=0;i<26;i++){
            var  code=String.fromCharCode(65+i);
            codelist.push(code);
        }
        for(var i=0;i<26;i++){
            var code1=String.fromCharCode(97+i);

            codelist.push(code1);
        }
        for(var i=0;i<10;i++){
            code2=String.fromCharCode(48+i);
            codelist.push(code2);
        }
        var codes="";
        for(var i=0;i<4;i++){
            var index=Math.round(Math.random()*(codelist.length-1));
            var  code3=codelist[index];
            codes+=code3;
        }

        return codes;
    }
</script>

</html>