
<!DOCTYPE html>
<html>
  <head>
    <title>电影列表</title>
    <!-- <link rel='stylesheet' href='/stylesheets/style.css' /> -->
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <script src="/bootstrap/js/jquery-1.10.1.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <style>
      /* .box{width:100%;height:500px;background: -webkit-linear-gradient(top, red 20%, yellow 50%, green 100%);} */
      /* .box{width:100%;overflow: hidden;;background: -webkit-radial-gradient(bottom left,red 10% ,green 60%, blue);} */
      img{max-height:60px !important;}
    </style>
  </head>
  <body>
    <%- include("header",{title:"影评列表"}) %>
    <header class="text-center">
      <ul class="nav navbar-nav">
        <li><a href="/">首页</a></li>
        <li><a href="/login">登录</a></li>
        <li><a href="/register">注册</a></li>
        <li><a href="/movie">电影</a></li>
      </ul>
    </header>
    <div class="container box">
        <div class="col-md-12"> 
            <button class="btn btn-info" onclick="window.location.href='/comments/list?mid=<%- mid %>&movie=1'">查看当前电影的所有评论</button>
            <button class="btn btn-primary" onclick="window.location.href='/comments/list?my=true&mid=<%- mid %>'">查看我的所有评论</button>
        <table class="table table-hover table-bordered">
            <caption class="h1 text-info">电影评论</caption>
            <tr>
                <td>序号</td>
                <td>电影名称</td>
                <td>评论人</td>
                <td>标题</td>
                <td>内容</td>
                <td>时间</td>
                <td>操作</td>
            </tr>
            <% if(result.length>0){ %>
           <% result.forEach((item,index)=>{ %>
              <tr>
                  <td><%- index+1 %></td>
                  <td><a href="/comments/mv/detail?mid=<%-item.mid%>"><%- item.mtitle %></a></td>
                  <td><%- item.username %></td>
                  <td><a href="/comments/detail?uid=<%-item.uid%>"><%- item.title %></a></td>
                  <td><%- item.content %></td>
                  <td><%- item.time %></td>
                  <td>
                    <!-- <button <%- username==item.username?'':'disabled' %> onclick="getId('<%-item._id%>')" class="btn btn-primary" data-toggle="modal" data-target="#updatebox">修改</button> -->
                    <button <%- username==item.username?'':'disabled' %> onclick="getUId('<%-item.uid%>')" class="btn btn-primary" data-toggle="modal" data-target="#updatebox">修改</button>
                    <button <%- username==item.username?'':'disabled' %> onclick="getId('<%-item._id%>')" class="btn btn-danger" data-toggle="modal" data-target="#deletebox">删除</button>
                  </td>
              </tr>
           <% }) %>
           <%  }else{ %>
                <tr>
                  <td colspan="7" class="h4 text-center text-danger">
                    <p>暂无数据</p>
                  </td>
                </tr>
          <%  } %>
            <tr>
              <td colspan="7" class="h4 text-right text-danger">
                  <button onclick="getId(-1)" class="btn btn-danger" data-toggle="modal" data-target="#deletebox">删除所有</button>
              </td>
            </tr>
            <tr>
              <td colspan="7" class="h4 text-center text-primary">
                <a href="/comments/list?mid=<%- mid %>&pageNo=1">首页</a>
                <a href="/comments/list?mid=<%- mid %>&pageNo=<%- pageNo<=1?1:pageNo-1 %>">上一页</a>
                <a href="/comments/list?mid=<%- mid %>&pageNo=<%- pageNo>=totalpage?totalpage:pageNo+1 %>">下一页</a>
                <a href="/comments/list?mid=<%- mid %>&pageNo=<%- totalpage %>">尾页</a>
                <p>
                  <%- pageNo %>/<%- totalpage %> 共<%- count %>条
                </p>
              </td>
            </tr>
        </table>
        </div>
      </div>


      <div class="modal fade" tadIndex="-1" role="dialog" id="deletebox">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                      <h4 class="modal-title">你确定删除评论吗?</h4>
                  </div>
                  <div class="modal-body">
                      <p>请确认无误后删除</p>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-primary"  data-dismiss="modal" >取消</button>
                      <button type="button" class="btn btn-danger" onclick="del('<%- mid %>')">确定</button>
                  </div>
              </div>
          </div>
      </div>
  
      <div class="modal fade" tadIndex="-1" role="dialog" id="updatebox">
              <div class="modal-dialog" role="document">
                  <div class="modal-content">
                      <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                          </button>
                          <h4 class="pull-left">更新评论</h4>
                      </div>
                      <div class="modal-body">                          
                              <div class="form-group">
                                  <label for="usernameControl">标题</label>
                                  <input type="text" class="form-control"  name="title" id="usernameControl" placeholder="标题">
                              </div>
                              <div class="form-group">
                                  <label for="passwordControl">内容:</label>
                                  <input type="text" class="form-control" name="content" id="passwordControl" placeholder="内容">
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-primary"  data-dismiss="modal" >取消</button>
                                <button type="submit" class="btn btn-danger" onclick="dell('<%- mid %>')">确定</button>
                            </div>                        
                      </div>
                      
                  </div>
              </div>
          </div>  
  </body>
  
</html>

<script>
    var arg = null;  
    function getId(_id){
        arg = _id;
        console.log(arg);
    }
    var arg2 = null;  
    function getUId(uid){
        arg2 = uid;
        console.log(arg2);
    }
    function del(mid){
        $("#deletebox").modal("hide");
        window.location.href = "/comments/delete?_id="+ arg+"&mid="+mid;  
    }

    function dell(mid){
        var title=$("#usernameControl").val();
        var content=$("#passwordControl").val();
        $("#deletebox").modal("hide");
        // window.location.href = "/comments/revise?_id="+ arg+"&mid="+mid+"&title="+title+"&content="+content;  
        window.location.href = "/comments/revise?uid="+arg2+"&mid="+mid+"&title="+title+"&content="+content;  
    }
</script>