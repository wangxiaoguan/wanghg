<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        *{padding: 0;margin: 0;list-style: none;}
        #box{width:1000px;overflow: hidden;margin:20px }
        #province,#city,#area{height:40px;}
        #province span{display:inline-block;padding:0 5px;color:green;}
        #province span:hover{background: fuchsia;}
        #city span{display:inline-block;padding:0 5px;color:red;}
        #city span:hover{background:orange;}
        #area span{display:inline-block;padding:0 5px;color:sienna;}
        #area span:hover{background:blue;}
        #weather span{display:inline-block;padding:5px;}
        span:hover{cursor:pointer}
    </style>
</head>
<body>
<div id="box">
    <div id="province"></div>
    <div id="city"></div>
    <div id="area"></div>
</div>
<div id="weather"></div>
<div id="forecast7d"></div>
</body>
<script>

    var province=document.getElementById("province");
    var city=document.getElementById("city");
    var area=document.getElementById("area");
    var observe=document.getElementById("observe");
    var forecast7d=document.getElementById("forecast7d");

    var req=new XMLHttpRequest();
    req.open("get","http://api.yytianqi.com/citylist/id/2",true);
    req.send();
    var previncelist;
    var spancitylist;
    req.onreadystatechange=function() {
        if (req.readyState == 4 && req.status == 200) {
            var result = req.responseText;
            var object = JSON.parse(result);
            previncelist =object.list;
            var html = "";
            previncelist.map(function (item) {
                html += "<span>" + item.name + "</span>";
            });
            province.innerHTML= html;//省份城市
            var spanlist = province.getElementsByTagName("span");
            for (var i = 0; i < spanlist.length; i++) {
                (function(i){
                    spanlist[i].onclick = function() {
                        var spancity = previncelist.filter(function (item) {
                            return spanlist[i].innerHTML == item.name
                        });
                        var html = "";
                        spancitylist = spancity[0].list;
                        spancitylist.map(function (item) {
//                            html+=`<span onclick="show('${item.city_id}')">${item.name}</span>`;
                            html+=`<span onmouseover="show('${item.city_id}')" onclick="getObserveData('${item.city_id}')">${item.name}</span>`;
                        });
                        city.innerHTML= html;//市级城市
                    }
                })(i);
            }
        }
    };
    function show(city_id) {
        var arealist=spancitylist.filter(function (item) {
            return  city_id==item.city_id
        })[0];
        var html="";
        if(arealist.list){
            arealist.list.map(function (item) {
                html+=`<span onmouseover="show('${item.city_id}')" onclick="getObserveData('${item.city_id}')">${item.name}</span>`;
            });
        }
        area.innerHTML= html;//区级城市/县级
    }


    function getObserveData(cityID) {
        var req = new XMLHttpRequest();
        req.open("get", `http://api.yytianqi.com/observe?city=${cityID}&key=9b7uc0d64832as25`,true);
        req.send();
        req.onreadystatechange = function () {
            if (req.readyState == 4 && req.status == 200) {
                var result = req.responseText;
                var list = JSON.parse(result);
                var allData = list.data;
                var cityName = allData.cityName;
                var lastUpdate = allData.lastUpdate;
                var tq = allData.tq;
                var qw = allData.qw;
                var fl = allData.fl;
                var fx = allData.fx;
                var html = "";
                if (allData) {
                    html = `<p>城市:${cityName}</p>
                    <p>更新:${lastUpdate}</p>
                    <p>天气:${tq}</p>
                    <p>温度:${qw}</p>
                    <p>风速:${fl}</p>
                    <p>风向:${fx}</p>`;
                }
            }else {observe.innerHTML="";}
            observe.innerHTML=html;
        }
    }
    function getForecast7dData(cityID) {
        var req = new XMLHttpRequest();
        req.open("get",`http://api.yytianqi.com/forecast7d?city=${cityID}&key=9b7uc0d64832as25`,true);
        req.send();
        req.onreadystatechange = function () {
            if (req.readyState == 4 && req.status == 200) {
                var result = req.responseText;
                var object = JSON.parse(result);
                var Data = object.data;
                var cityName = Data.cityName;//城市名称
                var time =Data.sj; //数据更新时间
                var list=Data.list;
                var html = "";
                for(var i=0;i<list.length;i++){
                    var item=list[i];
                    var tq1 = item.tq1;//白天天气
                    var qw1 = item.qw1;//白天气温
                    var fl1 = item.fl1;//白天风力
                    var fx1 = item.fx1;//白天风向
                    var date=item.date;//预报日期
                    html+=`<p>白天天气${tq1}</p>
                    <p>白天气温${qw1}</p>
                    <p>白天风力${fl1}</p>
                    <p>白天风向${fx1}</p>
                    <p>预报日期${date}</p>`;
                }
                forecast7d.innerHTML=html;
            }



















    getPekingData();
    function getPekingData() {
        var req = new XMLHttpRequest();
        req.open("get", `http://api.yytianqi.com/observe?city=CH010100&key=9b7uc0d64832as25`,true);
        req.send();
        req.onreadystatechange = function () {
            if (req.readyState == 4 && req.status == 200) {
                var result = req.responseText;
                var list = JSON.parse(result);
                var allData = list.data;
                var cityName = allData.cityName;
                var lastUpdate = allData.lastUpdate;
                var tq = allData.tq;
                var qw = allData.qw;
                var fl = allData.fl;
                var fx = allData.fx;
                var html = "";
                    html = `<p><span>城市</span><span>${cityName}</span></p>
                    <p><span>更新</span><span>${lastUpdate}</span></p>
                    <p><span>天气</span><span>${tq}</span></p>
                    <p><span>温度</span><span>${qw}</span></p>
                    <p><span>风速</span><span>${fl}</span></p>
                    <p><span>风向</span><span>${fx}</span></p>`;
                }
            weather.innerHTML=html;
        }




</script>
</html>